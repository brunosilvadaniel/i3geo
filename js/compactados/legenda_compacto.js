if(typeof(i3GEO)==='undefined'){var i3GEO={}}i3GEO.legenda={incluiBotaoLibera:true,ID:"",CAMADASSEMLEGENDA:[],POSICAO:"",CONFIG:{"idOnde":"","idLegenda":""},inicia:function(config){if(config){$.each(config,function(i,v){i3GEO.legenda.CONFIG[i]=v})}config=i3GEO.legenda.CONFIG;if(!$i(config.idOnde)){return}i3GEO.eventos.adicionaEventos("NAVEGAMAPA",["i3GEO.legenda.atualiza()"]);i3GEO.legenda.atualiza()},atualiza:function(){var idleg=$i(i3GEO.legenda.CONFIG.idLegenda);var tamanho=$($("#"+i3GEO.legenda.CONFIG.idLegenda).attr("data-template")).attr("data-size").split(",");if(idleg&&idleg.style.display==="block"){i3GEO.php.criaLegendaJSON(i3GEO.legenda.montaLegenda,"",tamanho[0],tamanho[1])}},montaLegenda:function(retorno){var legenda="",t,idleg;idleg=$i(i3GEO.legenda.CONFIG.idLegenda);idleg.innerHTML=$trad("o1");if(retorno.data.legenda!=""){$(".legendaTemaSolto").remove();t=Mustache.to_html("{{#data}}"+$($("#"+i3GEO.legenda.CONFIG.idLegenda).attr("data-template")).html()+"{{/data}}",{"data":retorno.data.legenda});idleg.innerHTML=t;$("#"+i3GEO.legenda.CONFIG.idLegenda).find(".draggable").draggable({helper:"clone",appendTo:"body",start:function(event,ui){$(this).hide()},stop:function(event,ui){$(this).css({"position":"absolute","top":(event.clientY-event.offsetY),"left":(event.clientX-event.offsetX)});$(this).addClass("legendaTemaSolto");$("body").append($(this));$(this).show()}})}else{idleg.innerHTML=""}},png:function(){var obj=$i("i3GEOconteudoLegenda");if($i("wlegenda")){obj.style.width=$i("wlegenda").style.width}else{obj.style.width="400px"}if($i("wlegenda_corpo")){obj.style.height=$i("wlegenda_corpo").style.height}else{obj.style.height="400px"}i3GEO.mapa.dialogo.html2canvas(obj)},mostraSoLegenda:function(){var n,i,temp,raiz=$i("corpoLegi").parentNode;temp=raiz.getElementsByClassName("i3GEOLegendaExcluiTema");n=temp.length;for(i=0;i<n;i++){temp[i].style.display="none"}temp=raiz.getElementsByTagName("input");n=temp.length;for(i=0;i<n;i++){temp[i].style.display="none"}temp=raiz.getElementsByClassName("temaSwitch");n=temp.length;for(i=0;i<n;i++){temp[i].style.display="none"}},ativaDesativaTema:function(inputbox){var temp=function(){i3GEO.php.corpo(i3GEO.atualiza,i3GEO.configura.tipoimagem);i3GEO.arvoreDeCamadas.atualiza("");i3GEO.janela.fechaAguarde("redesenha")};if(!inputbox.checked){i3GEO.php.ligatemas(temp,inputbox.value,"")}else{i3GEO.php.ligatemas(temp,"",inputbox.value)}},escondeTema:function(tema){var d=$i("legendaLayer_"+tema);if(d){d.style.display="none";i3GEO.mapa.legendaHTML.CAMADASSEMLEGENDA.push(tema)}},escondeTemasMarcados:function(){var temas=i3GEO.mapa.legendaHTML.CAMADASSEMLEGENDA,n=temas.length,i,temp;for(i=0;i<n;i++){temp=$i(temas[i]);if(temp){temp.style.display="none"}}},mostraTodosOsTemas:function(){i3GEO.mapa.legendaHTML.CAMADASSEMLEGENDA=[];i3GEO.mapa.legendaHTML.atualiza()},libera:function(ck,largura,altura,topo,esquerda){if(!ck){ck="nao"}if(!largura){largura=360}if(!altura){altura=300}var cabecalho,minimiza,janela,titulo;if(i3GEO.mapa.legendaHTML.POSICAO!=""){topo=i3GEO.mapa.legendaHTML.POSICAO[1];esquerda=i3GEO.mapa.legendaHTML.POSICAO[0]}i3GEO.util.removeChild("corpoLegi");i3GEO.util.defineValor(i3GEO.mapa.legendaHTML.ID,"innerHTML","");janela=YAHOO.i3GEO.janela.manager.find("wlegenda");if(janela){i3GEO.janela.destroi("wlegenda")}cabecalho=function(){};minimiza=function(){var t=i3GEO.janela.minimiza("wlegenda","100px");if(t==="min"){$i("legendaTituloI").style.display="none"}else{$i("legendaTituloI").style.display="block"}};titulo="<span class='i3GEOiconeFerramenta i3GEOiconeLegenda' title='"+$trad("P3")+"'></span>"+"<div class='i3GeoTituloJanela' id='legendaTituloI'>"+$trad("p3")+"</div>";janela=i3GEO.janela.cria(largura+"px",altura+"px","","","",titulo,"wlegenda",false,"hd",cabecalho,minimiza,"","","","","nao");$i("wlegenda_corpo").style.backgroundColor="white";i3GEO.mapa.legendaHTML.ID="wlegenda_corpo";i3GEO.eventos.adicionaEventos("NAVEGAMAPA",["i3GEO.mapa.legendaHTML.atualiza()"]);janela[0].moveEvent.subscribe(function(o,p){i3GEO.mapa.legendaHTML.POSICAO=p[0]});i3GEO.mapa.legendaHTML.atualiza();if(topo&&esquerda){janela=YAHOO.i3GEO.janela.manager.find("wlegenda");janela.moveTo(esquerda,topo)}},inverteStatusClasse:function(leg){var temp=function(retorno){i3GEO.Interface.atualizaTema(retorno,leg.name)};i3GEO.php.inverteStatusClasse(temp,leg.name,leg.value)}};