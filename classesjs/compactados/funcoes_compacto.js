try{$i("i3geo")}catch(e){$i=function(i){return document.getElementById(i)}}function criaContainerRichdraw(){try{if(!$i("divGeometriasTemp")){var pos=[0,0];if($i("img"))var pos=i3GEO.util.pegaPosicaoObjeto($i("img"));var novoel=document.createElement("div");novoel.id="divGeometriasTemp";var ne=novoel.style;ne.cursor="crosshair";ne.zIndex=0;ne.position="absolute";ne.width=objmapa.w;ne.height=objmapa.h;ne.border="1px solid black";ne.display="none";ne.top=pos[1];ne.left=pos[0];document.body.appendChild(novoel)}var divgeo=$i("divGeometriasTemp");divgeo.innerHTML="";var renderer;try{renderer=new VMLRenderer();richdraw=new RichDrawEditor(divgeo,renderer)}catch(e){renderer=new SVGRenderer();richdraw=new RichDrawEditor(divgeo,renderer)}richdraw.editCommand('fillcolor','red');richdraw.editCommand('linecolor','gray');richdraw.editCommand('linewidth','1px');richdraw.editCommand('mode','line');divgeo.style.display="block";ativaClicks(divgeo)}catch(e){alert("Erro ao tentar criar container richdraw")}}function mudaiconf(i){try{YAHOO.log("mudaiconf","i3geo");if(objmapa.objtips.length>0){var ot=objmapa.objtips.length-1;if(ot>=0){do{if(objmapa.objtips[ot]){objmapa.objtips[ot].innerHTML="";objmapa.objtips[ot].style.display="none"}}while(ot--)}}objmapa.objtips=new Array();limpacontainerf();g_tipoacao=i;if($i("divGeometriasTemp")){$i("divGeometriasTemp").style.display="none"}YAHOO.log("Fim mudaiconf","i3geo")}catch(e){alert("Ocorreu um erro. mudaiconf"+e)}}function ativaClicks(docMapa){docMapa.onmouseover=function(){this.onmousemove=function(exy){try{try{clearTimeout(i3GEO.eventos.TIMERPARADO)}catch(e){var a=e}i3GEO.eventos.TIMERPARADO=setTimeout('i3GEO.eventos.mouseParado()',i3GEO.configura.tempoMouseParado);capturaposicao(exy);if(g_destaca!=""){$i("div_d").style.clip='rect('+(objposicaocursor.imgy-destacaTamanho)+" "+(objposicaocursor.imgx-10)+" "+(objposicaocursor.imgy-10)+" "+(objposicaocursor.imgx-destacaTamanho)+')'}}catch(e){var e=""}try{i3GEO.eventos.mousemoveMapa()}catch(e){var e=""}}};docMapa.onmouseout=function(){try{objmapa.parado="parar";mostradicasf(this,'')}catch(e){var e=""}};docMapa.onmousedown=function(exy){try{capturaposicao(exy);if((g_tipoacao=="zoomli")||(g_tipoacao=="selecaobox")){if($i("box1")){var i=$i("box1").style;i.width=0;i.height=0;i.visibility="visible";i.display="none";i.left=objposicaocursor.telax+g_postpx;i.top=objposicaocursor.telay+g_postpx}boxxini=objposicaocursor.telax;boxyini=objposicaocursor.telay;tamanhox=0;tamanhoy=0}i3GEO.eventos.mousedownMapa()}catch(e){var e=""}};docMapa.onclick=function(){try{i3GEO.eventos.mousecliqueMapa()}catch(e){var e=""}};docMapa.onmouseup=function(){try{if(g_tipoacao=="zoomli"){zoomboxf("termina")}if(g_tipoacao=="selecaobox"){zoomboxf("termina")}i3GEO.eventos.mouseupMapa()}catch(e){var e=""}}}function movelentef(){try{if($i("lente")){if($i("lente").style.visibility=="visible"){var pos=i3GEO.util.pegaPosicaoObjeto($i("img"));var esq=(objposicaocursor.telax-pos[0])*2.25;var topo=(objposicaocursor.telay-pos[1])*2.25;var clipt="rect("+(topo-40)+" "+(esq+40)+" "+(topo+40)+" "+(esq-40)+")";var i=$i("lente").style;i.clip=clipt;eval("i."+g_tipotop+"= (pos[1] - (topo - 40)) + g_postpx");eval("i."+g_tipoleft+"= (pos[0] - (esq - 40)) + g_postpx")}}}catch(e){var e=""}}function zoomboxf(tipo){var pos=i3GEO.util.pegaPosicaoObjeto($i("img"));if($i("box1")){var bx=$i("box1");var bxs=bx.style}else{alert("Box nao encontrado");return}switch(tipo){case"desloca":bxs.display="block";ppx=objposicaocursor.telax;py=objposicaocursor.telay;if(navm){if((ppx>boxxini)&&((ppx-boxxini-2)>0)){bxs.width=ppx-boxxini-2}if((py>boxyini)&&((py-boxyini-2)>0)){bxs.height=py-boxyini-2}if(ppx<boxxini){bxs.left=ppx;bxs.width=boxxini-ppx+2}if(py<boxyini){bxs.top=py;bxs.height=boxyini-py+2}}else{if(ppx>boxxini){bxs.width=ppx-boxxini+"px"}if(py>boxyini){bxs.height=py-boxyini+"px"}if(ppx<boxxini){bxs.left=ppx+"px";bxs.width=boxxini-ppx+"px"}if(py<boxyini){bxs.top=py+"px";bxs.height=boxyini-py+"px"}}break;case"termina":md=1;eval('pix = parseInt(document.getElementById("box1").style.'+g_tipoleft+")");eval('piy = parseInt(document.getElementById("box1").style.'+g_tipotop+")");xfig0=parseInt(bxs.width)-pos[0];yfig0=parseInt(bxs.height)-pos[1];xfig=pix+(parseInt(bxs.width))-pos[0];yfig=piy+(parseInt(bxs.height))-pos[1];amext=objmapa.extent.split(" ");dx=((amext[0]*-1)-(amext[2]*-1))/(tamanhox-1);dy=((amext[1]*1)-(amext[3]*1))/(tamanhoy-1);if(dy<0)dy=dy*-1;nx=g_celula*xfig;ny=g_celula*yfig;x1=(amext[0]*1)+nx;y1=(amext[3]*1)-ny;xfig=pix-pos[0];yfig=piy-pos[1];if(dy<0)dy=dy*-1;nx=g_celula*xfig;ny=g_celula*yfig;x2=(amext[0]*1)+nx;y2=(amext[3]*1)-ny;v=x2+" "+y2+" "+x1+" "+y1;if(g_tipoacao!="selecaobox"){if(x1!=x2){objmapa.extent=v;i3GEO.navega.zoomExt(i3GEO.configura.locaplic,i3GEO.configura.sid,g_tipoimagem,v)}}else{if(x1!=x2){try{var doc=(navm)?document.frames("wdocai").document:$i("wdocai").contentDocument;var tipo="adiciona";if(doc.getElementById("tipoOperacao")){tipo=doc.getElementById("tipoOperacao").value}if(objmapa.temaAtivo==""){alert("Nenhum tema ativo");return}if((tipo!="limpa")&&(tipo!="inverte")){i3GEO.janela.abreAguarde("ajaxredesenha",$trad("o1"));var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=selecaobox&ext="+v+"&g_sid="+i3GEO.configura.sid+"&tipo="+tipo+"&tema="+objmapa.temaAtivo;cpObj.call(p,"selecaobox",ajaxredesenha)}}catch(e){var e=""}}}bxs.visibility="hidden";bxs.width=0;bxs.height=0;break}}function ativaEntorno(){if(objmapa.mapfile==""){alert("Essa opcao nao pode ser ativada. Consulte o administrador do sistema. Mapfile nao esta exposto.");return}if(g_entorno=="sim"){var letras=["L","O","N","S"];for(var l=0;l<4;l++){if($i("img"+letras[l])){$i("img"+letras[l]).style.display="none";$i("img"+letras[l]).src=""}}$left("img",0);$top("img",0);g_entorno="nao";alert("Entorno desativado");$i("img").style.visibility="visible";$i("img").style.display="block"}else{geraURLentorno();var letras=["L","O","N","S"];for(var l=0;l<4;l++){if($i("img"+letras[l])){$i("img"+letras[l]).style.width=objmapa.w;$i("img"+letras[l]).style.height=objmapa.h;$i("img"+letras[l]).style.display="block"}}g_entorno="sim";ajustaEntorno();alert("Entorno ativado. o desenho do mapa pode demorar mais.")}}function geraURLentorno(){var nny=(objmapa.h/2)*-1;var nnx=objmapa.w/2;var sy=objmapa.h+(objmapa.h/2);var sx=objmapa.w/2;var lx=objmapa.w+(objmapa.w/2);var ly=objmapa.h/2;var ox=(parseInt(objmapa.w/2))*-1;var oy=objmapa.h/2;var u=window.location.protocol+"\/\/"+window.location.host+objmapa.cgi+"?map="+objmapa.mapfile;u+="&mode=map&imgext="+objmapa.extent+"&mapsize="+nnx+" "+oy;var sul=u+"&imgxy="+sx/2+" "+sy/2;var norte=u+"&imgxy="+nnx/2+" "+nny/2;var leste=u+"&imgxy="+lx/2+" "+ly/2;var oeste=u+"&imgxy="+ox/2+" "+oy/2;$i("imgS").src=sul;$i("imgN").src=norte;$i("imgL").src=leste;$i("imgO").src=oeste}function ajustaEntorno(){$left("img",objmapa.w*-1);$left("imgS",objmapa.w*-1);$left("imgL",objmapa.w);$left("imgO",objmapa.w*-3);$left("imgN",objmapa.w*-1);$top("img",objmapa.h*-1);$top("imgS",objmapa.h*-1);$top("imgL",objmapa.h*-1);$top("imgN",objmapa.h*-1);$top("imgO",objmapa.h*-1)}function i3geo_comboGruposMenu(funcaoOnchange,idDestino,idCombo,largura,altura){var combo=function(retorno){obGrupos=retorno.data;var ins="<select id='"+idCombo+"' SIZE="+altura+" style=width:"+largura+"px onchange='"+funcaoOnchange+"(this.value)' ><option value='' >Escolha um grupo:</option>";for(ig=0;ig<obGrupos.grupos.length;ig++){if(obGrupos.grupos[ig].nome)ins+="<option value="+ig+" >"+obGrupos.grupos[ig].nome+"</option>"}$i(idDestino).innerHTML=ins+"</select>"};var p="classesphp/mapa_controle.php?funcao=pegalistadegrupos&map_file=''&listasgrupos=nao";var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"pegalistadegrupos",combo)}function i3geo_comboSubGruposMenu(funcaoOnchange,idDestino,idCombo,idGrupo,largura,altura){if(idGrupo!=""){var combo=function(retorno){var ins="<select id='"+idCombo+"' size="+altura+" style=width:"+largura+"px onchange='"+funcaoOnchange+"("+idGrupo+",this.value)' ><option value='' >Escolha um sub-grupo:</option>";if(retorno.data.subgrupo){var sg=retorno.data.subgrupo;for(ig=0;ig<sg.length;ig++){ins+="<option value="+ig+" >"+sg[ig].nome+"</option>"}}$i(idDestino).innerHTML=ins+"</select>"};var p="classesphp/mapa_controle.php?funcao=pegalistadeSubgrupos&map_file=''&grupo="+idGrupo;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"pegalistadeSubgrupos",combo)}}function i3geo_comboTemasMenu(funcaoOnchange,idDestino,idCombo,idGrupo,idSubGrupo,largura,altura){var combo=function(retorno){var ins="<select id='"+idCombo+"' size="+altura+" style=width:"+largura+"px onchange='"+funcaoOnchange+"("+idGrupo+","+idSubGrupo+",this.value)' ><option value='' >Escolha um tema:</option>";if(retorno.data.temas[i]){var sg=retorno.data.temas;for(ig=0;ig<sg.length;ig++){ins+="<option value="+sg[ig].tid+" >"+sg[ig].nome+"</option>"}}$i(idDestino).innerHTML=ins+"</select>"};var p="classesphp/mapa_controle.php?funcao=pegalistadetemas&map_file=''&grupo="+idGrupo+"&subgrupo="+idSubGrupo;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"pegalistadetemas",combo)}function remapaf(){YAHOO.log("remapaf","i3geo");clearTimeout(objmapa.tempo);objmapa.tempo="";objmapa.temaAtivo="";if($i(objmapa.guiaTemas+"obj")){if(g_operacao=="legenda"){var iguias=$i("legenda").getElementsByTagName("input")}else{var iguias=$i(objmapa.guiaTemas+"obj").getElementsByTagName("input")}var tsl=new Array();var tsd=new Array();var i=iguias.length-1;if(i>=0){do{if(iguias[i].type=="checkbox"){if(iguias[i].name=="layer"){if(iguias[i].checked==false){tsd.push(iguias[i].value)}if(iguias[i].checked==true){tsl.push(iguias[i].value)}}}}while(i--)}var remapaAdicNovos=function(retorno){if($i("buscatema")){var g=$i(objmapa.guiaMenu+"obj");if($i("arvoreAdicionaTema")){var g=$i("arvoreAdicionaTema")}var iguias=g.getElementsByTagName("input");var ta=new Array();var i=iguias.length-1;if(i>=0){do{if(iguias[i].type=="checkbox"){if(iguias[i].checked==true){ta.push(iguias[i].value);iguias[i].checked=false}}}while(i--)}if(ta.length>0){i3GEO.janela.fechaAguarde("remapa");i3GEO.janela.abreAguarde("ajaxredesenha",$trad("o1"));var temp=function(retorno){i3GEO.janela.fechaAguarde("ajaxredesenha");if(retorno.data.erro){alert(retorno.data.erro);return}ajaxredesenha("")};var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=adtema&temas="+(ta.toString())+"&g_sid="+i3GEO.configura.sid;cpObj.call(p,"adicionaTema",temp)}else{i3GEO.janela.fechaAguarde("remapa");i3GEO.janela.abreAguarde("ajaxredesenha",$trad("o1"));ajaxredesenha("")}}else{i3GEO.janela.fechaAguarde("remapa");i3GEO.janela.abreAguarde("ajaxredesenha",$trad("o1"));ajaxredesenha("")}};if((tsd.length>0)||(tsl.length>0)){i3GEO.janela.abreAguarde("remapa",$trad("o1"));var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=ligatemas&desligar="+(tsd.toString())+"&ligar="+(tsl.toString())+"&g_sid="+i3GEO.configura.sid;cpObj.call(p,"ligaDesligaTemas",remapaAdicNovos)}else{remapaAdicNovos()}i3GEO.janela.fechaAguarde("remapa")}else{eval(remapaAdicNovos)}YAHOO.log("Fim remapaf","i3geo")}function calcposf(){try{YAHOO.log("calcposf","i3geo");imagemxi=0;imagemyi=0;imagemxref=0;imagemyref=0;if(!$i("i3geo")){return}if($i("i3geo").style.left){imagemxi+=parseInt($i("i3geo").style.left)}if($i("i3geo").style.top){imagemyi+=parseInt($i("i3geo").style.top)}var dc=$i("i3geo");if($i("contemImg")){var dc=$i("contemImg")}else{var dc=$i("img")}if($i("openlayers")){var dc=$i("openlayers")}if($i("flamingo")){var dc=$i("flamingo")}while((dc.offsetParent)&&(dc.offsetParent.id!="i3geo")){dc=dc.offsetParent;imagemxi=imagemxi+dc.offsetLeft;imagemyi=imagemyi+dc.offsetTop}if($i("corpoMapa")){$i("corpoMapa").style.position="absolute";$left("corpoMapa",imagemxi);$top("corpoMapa",imagemyi);if($i("i3geo").style.left){$left("corpoMapa",imagemxi-parseInt($i("i3geo").style.left))}if($i("i3geo").style.top){$top("corpoMapa",imagemyi-parseInt($i("i3geo").style.top))}}if($i("ref")){var dc=$i("ref");while(dc.offsetParent.id!="i3geo"){dc=dc.offsetParent;imagemxref=imagemxref+dc.offsetLeft;imagemyref=imagemyref+dc.offsetTop}}if($i("aguarde")){$top("aguarde",imagemyi);$left("aguarde",imagemxi)}YAHOO.log("Fim calcposf","i3geo")}catch(e){alert("Ocorreu um erro. calcposf"+e)}}function capturaposicao(e){if(!e)var e=window.event;if(e.target){var targ=e.target}else if(e.srcElement)var targ=e.srcElement;if(targ.id==""&&$i("img")){var targ=$i("img")}if(g_panM=="sim"){var pos=i3GEO.util.pegaPosicaoObjeto(targ.parentNode)}else{var pos=i3GEO.util.pegaPosicaoObjeto(targ)}if((g_entorno=="sim")&&(g_panM=="sim")){pos[0]=pos[0]-objmapa.w;pos[1]=pos[1]-objmapa.h}var mousex=0;var mousey=0;if(e.pageX||e.pageY){mousex=e.pageX;mousey=e.pageY}else if(e.clientX||e.clientY){mousex=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;mousey=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}var xfig=mousex-pos[0];var yfig=mousey-pos[1];var xreffig=xfig;var yreffig=yfig;var xtela=mousex;var ytela=mousey;var c=g_celula;var ex=objmapa.extent;try{if(targ.id=="imagemReferencia"){var c=g_celularef;var ex=objmapa.extentref;var r=$i("i3geo_rosa");if(r)r.style.display="none"}}catch(e){g_celularef=0}var teladd=i3GEO.calculo.tela2dd(xfig,yfig,c,ex);var teladms=i3GEO.calculo.dd2dms(teladd[0],teladd[1]);objposicaocursor.ddx=teladd[0];objposicaocursor.ddy=teladd[1];objposicaocursor.dmsx=teladms[0];objposicaocursor.dmsy=teladms[1];objposicaocursor.telax=xtela;objposicaocursor.telay=ytela;objposicaocursor.imgx=xfig;objposicaocursor.imgy=yfig;objposicaocursor.refx=xreffig;objposicaocursor.refy=yreffig;ajaxTip=""}function posicaomouse(){this.x=0;this.y=0}function posicaocursor(){this.ddx=0;this.ddy=0;this.dmsx='';this.dmsy='';this.telax=0;this.telay=0;this.imgx=0;this.imgy=0;this.refx=0;this.refy=0}function pontosdist(){this.xpt=new Array();this.ypt=new Array();this.dist=new Array();this.xtela=new Array();this.ytela=new Array();this.ximg=new Array();this.yimg=new Array();this.linhas=new Array()}function desenhoRichdraw(tipo,objeto,n){if(richdraw&&$i("img")){var pos=i3GEO.util.pegaPosicaoObjeto($i("img"));if((tipo=="resizeLinha")||(tipo=="resizePoligono")&&navn){try{richdraw.renderer.resize(objeto,0,0,objposicaocursor.imgx,objposicaocursor.imgy)}catch(e){window.status=n+" erro ao movimentar a linha "}}if((tipo=="resizeLinha")&&navm){try{var r=$i(richdraw.container.id);r.removeChild(r.lastChild);var dy=objposicaocursor.imgy;var dx=objposicaocursor.imgx-(objmapa.w/2);richdraw.renderer.create(richdraw.mode,richdraw.fillColor,richdraw.lineColor,richdraw.lineWidth,(pontosdistobj.ximg[n-1])-(objmapa.w/2)-1,pontosdistobj.yimg[n-1]-3,dx,dy-3)}catch(e){window.status=n+" erro ao movimentar a linha "}}if((tipo=="resizePoligono")&&navm){try{var r=$i(richdraw.container.id);r.removeChild(r.lastChild);r.removeChild(r.lastChild);var dy=objposicaocursor.imgy;var dx=objposicaocursor.imgx-(objmapa.w/2);richdraw.renderer.create(richdraw.mode,richdraw.fillColor,richdraw.lineColor,richdraw.lineWidth,(pontosdistobj.ximg[n-1])-(objmapa.w/2)-1,pontosdistobj.yimg[n-1]-3,dx,dy-3);richdraw.renderer.create(richdraw.mode,richdraw.fillColor,richdraw.lineColor,richdraw.lineWidth,(pontosdistobj.ximg[0])-(objmapa.w/2)-1,pontosdistobj.yimg[0]-3,dx,dy-3)}catch(e){window.status=n+" erro ao movimentar a linha "}}if(tipo=="insereCirculo"){if(navn){var dx=Math.pow(((pontosdistobj.xtela[n])*1)-((pontosdistobj.xtela[n-1])*1),2);var dy=Math.pow(((pontosdistobj.ytela[n])*1)-((pontosdistobj.ytela[n-1])*1),2);var w=Math.sqrt(dx+dy);try{richdraw.renderer.create('circ','','rgb(250,250,250)',richdraw.lineWidth,pontosdistobj.ximg[n-1],pontosdistobj.yimg[n-1],w,w)}catch(e){window.status=n+" erro ao desenhar o raio"}}else{var dx=Math.pow(((pontosdistobj.xtela[n])*1)-((pontosdistobj.xtela[n-1])*1),2);var dy=Math.pow(((pontosdistobj.ytela[n])*1)-((pontosdistobj.ytela[n-1])*1),2);var w=Math.sqrt(dx+dy);try{richdraw.renderer.create('circ','','rgb(250,250,250)',richdraw.lineWidth,pontosdistobj.ximg[n-1]-w,pontosdistobj.yimg[n-1]-w,w*2,w*2)}catch(e){window.status=n+" erro ao desenhar o raio"}}}}}function incluir(path){i3GEO.janela.abreAguarde("ajaxredesenha",$trad("o1"));var temp=path.split(".");if((temp[1]=="SHP")||(temp[1]=="shp")){var f="adicionaTemaSHP"}else{var f="adicionaTemaIMG"}var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?g_sid="+i3GEO.configura.sid+"&funcao="+f+"&arq="+path;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,f,ajaxredesenha)}function inseremarcaf(xi,yi,funcaoOnclick){try{if(!$i("pontosins")){var novoel=document.createElement("div");novoel.id="pontosins";var i=novoel.style;i.position="absolute";i.top=parseInt($i("img").style.top);i.left=parseInt($i("img").style.left);document.body.appendChild(novoel)}var container=$i("pontosins");var novoel=document.createElement("div");var i=novoel.style;i.position="absolute";i.zIndex=2000;i.top=(yi-4)+"px";i.left=(xi-4)+"px";i.width="4px";i.height="4px";var novoimg=document.createElement("img");if(arguments.length==2){funcaoOnclick=""}if(funcaoOnclick!=""){novoimg.onclick=funcaoOnclick}novoimg.src=i3GEO.configura.locaplic+"/imagens/dot1.gif";with(novoimg.style){width="6px";height="6px";zIndex=2000}novoel.appendChild(novoimg);container.appendChild(novoel)}catch(e){alert("Ocorreu um erro. inseremarcaf"+e)}}function limpacontainerf(){if($i("pontosins")){$i("pontosins").innerHTML=""}if($i("mostradistancia")){$i("mostradistancia").style.display="none"}}function recuperamapa(){g_recupera=1;var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=recuperamapa&g_sid="+i3GEO.configura.sid;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"recuperamapa",remapaf)}function testafuncoes(){}