function ajaxexecASXml(programa,funcao){if(programa.search("http")==0){var h=window.location.host;if(programa.search(h)<0){alert("OOps! Nao e possivel chamar um XML de outro host.\nContacte o administrador do sistema.\nConfigure corretamente o ms_configura.php");return}}var ohttp=ajaxhttp();ohttp.open("GET",programa,true);var retorno="";ohttp.onreadystatechange=function(){if(ohttp.readyState==4){var retorno=ohttp.responseText;if(retorno!=undefined){if(document.implementation.createDocument){var parser=new DOMParser();var dom=parser.parseFromString(retorno,"text/xml")}else{var dom=new ActiveXObject("Microsoft.XMLDOM");dom.async="false";dom.load(programa)}}else{var dom="erro"}if(funcao!="volta"){eval(funcao+'(dom)')}else{return dom}}};ohttp.send(null)}function ajaxEscalaGrafica(retorno){if((retorno.data!="erro")&&(retorno.data!=undefined)){eval(retorno.data);if($i("imagemEscalaGrafica")){var m=new Image();m.src=scaimagem;$i("imagemEscalaGrafica").src=m.src;i3GEO.gadgets.quadros.grava("escala",scaimagem)}}}function ajaxCorpoMapa(retorno){i3GEO.arvoreDeCamadas.atualiza(retorno.data.temas);if($i("mst")){$i("mst").style.display="block"}if(!$i("img")){return}try{i3GEO.janela.abreAguarde("ajaxCorpoMapa",$trad("o3"));if(retorno.data){var retorno=retorno.data}if(retorno.variaveis){var retorno=retorno.variaveis}if((retorno!="erro")&&(retorno!=undefined)){eval(retorno);$i("img").onload=function(){$i("img").onload="";i3GEO.gadgets.quadros.grava("imagem",mapimagem);var temp=function(retorno){eval(retorno.data);i3GEO.gadgets.quadros.grava("legenda",legimagem)};i3GEO.mapa.legendaIMAGEM.obtem(temp);if($i("banners")){$i("banners").style.height=objmapa.h}if($i("legenda")){$i("legenda").style.height=objmapa.h}if($i("imgtemp")){$i("imgtemp").style.display="none"}if($i("imgClone"))$i("imgClone").style.display="none";$i("img").style.display="block";i3GEO.janela.fechaAguarde("ajaxCorpoMapa")};$i("img").src=mapimagem}else{i3GEO.mapa.ajustaPosicao();i3GEO.janela.fechaAguarde();i3GEO.mapa.recupera.inicia()}i3GEO.mapa.recupera.TENTATIVA=0}catch(e){if(i3GEO.mapa.recupera.TENTATIVA==0){alert("Erro no mapa. Sera feita uma tentativa de recuperacao.");i3GEO.mapa.recupera.inicia()}else{alert("Recuperacao impossivel. Sera feita uma tentativa de reiniciar o mapa.");if(i3GEO.mapa.recupera.TENTATIVA==1){i3GEO.mapa.recupera.TENTATIVA=2;var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=reiniciaMapa&g_sid="+i3GEO.configura.sid;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"recuperamapa",ajaxredesenha)}}}}function ajaxredesenha(retorno){try{i3GEO.desenho.richdraw.clearWorkspace()}catch(e){};try{i3GEO.gadgets.quadros.avanca();if(retorno&&retorno.data.temas){i3GEO.janela.abreAguarde("ajaxiniciaParametros",$trad("o1"));ajaxIniciaParametros(retorno)}else{var legimagem="";if($i("img")){i3GEO.janela.abreAguarde("ajaxiniciaParametros",$trad("o1"));var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=corpo&tipoimagem="+g_tipoimagem+"&g_sid="+i3GEO.configura.sid;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"redesenhaCorpo",ajaxIniciaParametros)}i3GEO.janela.fechaAguarde("ajaxredesenha");if($i("openlayers")){$i("openlayers").innerHTML="";var b=objmapa.OL.getExtent();criaOL(Math.random()+Math.random()+Math.random()+Math.random());objmapa.OL.zoomToExtent(b)}if($i("flamingo")){atualizaFL()}if($i("wdocai")&&$i("guia5obj")){var doc=(navm)?document.frames("wdocai").document:$i("wdocai").contentDocument;if(doc.getElementById("guia5obj")){if(doc.getElementById("guia5obj").style.display=="block"){if(window.parent.frames["wdocai"].atualizaGrafico){window.parent.frames["wdocai"].atualizaGrafico()}}}}}}catch(e){alert("ajaxredesenha "+e)}}function ajaxIniciaParametros(retorno){i3GEO.ajuda.ativaLetreiro(i3GEO.configura.locaplic,i3GEO.configura.sid);var tempo="";if($i("openlayers")){$i("openlayers").innerHTML="";var b=objmapa.OL.getExtent();criaOL(Math.random()+Math.random()+Math.random()+Math.random());objmapa.OL.zoomToExtent(b)}if($i("flamingo")){atualizaFL()}i3GEO.util.insereMarca.limpa();if($i("mostradistancia")){$i("mostradistancia").style.display="none"}try{i3GEO.desenho.richdraw.fecha()}catch(e){};try{if($i("imgL")){var letras=["N","S","L","O"];for(var l=0;l<4;l++){$i("img"+letras[l]).src=""}}mapscale="";mapexten="";eval(retorno.data.variaveis);if($i("img")){if(!$i("imgtemp")){var ndiv=document.createElement("div");ndiv.id="imgtemp";ndiv.style.position="absolute";ndiv.style.border="1px solid blue";document.getElementById("corpoMapa").appendChild(ndiv)}if(g_tipoacao=="pan"){$i("imgtemp").style.left=parseInt($i("img").style.left);$i("imgtemp").style.top=parseInt($i("img").style.top);$i("imgtemp").style.width=objmapa.w;$i("imgtemp").style.height=objmapa.h;$i("imgtemp").style.display="block";$i("imgtemp").style.backgroundImage='url("'+$i("img").src+'")'}$i("img").style.left=0;$i("img").style.top=0;ajaxCorpoMapa(retorno)}i3GEO.arvoreDeCamadas.atualiza(retorno.data.temas);if(objmapa.scale!=mapscale)i3GEO.arvoreDeCamadas.atualizaFarol(mapscale);i3GEO.maparef.atualiza();objmapa.scale=mapscale;g_operacao="";i3GEO.arvoreDeCamadas.CAMADAS=retorno.data.temas;objmapa.cellsize=g_celula;objmapa.extent=mapexten;if($i("i3geo_escalanum")){$i("i3geo_escalanum").value=parseInt(mapscale)}if($i("mensagemt")){$i("mensagemt").value=mapexten}i3GEO.gadgets.quadros.grava("extensao",mapexten);i3GEO.janela.fechaAguarde("ajaxiniciaParametros");i3GEO.janela.fechaAguarde("aguardedoc");i3GEO.janela.fechaAguarde("ajaxredesenha");i3GEO.eventos.navegaMapa();if(i3GEO.configura.entorno=="sim"){i3GEO.navega.entorno.geraURL();i3GEO.navega.entorno.ajustaPosicao()}i3GEO.mapa.recupera.TENTATIVA=0}catch(e){if(i3GEO.mapa.recupera.TENTATIVA==0){alert("Erro no mapa. Sera feita uma tentativa de recuperacao.");i3GEO.mapa.recupera.inicia()}else{alert("Recuperacao impossivel. Sera feita uma tentativa de reiniciar o mapa.");if(i3GEO.mapa.recupera.TENTATIVA==1){i3GEO.mapa.recupera.TENTATIVA=2;var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=reiniciaMapa&g_sid="+i3GEO.configura.sid;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"recuperamapa",ajaxredesenha)}}}i3GEO.ajuda.mostraJanela("Tempo de redesenho em segundos: "+tempo,"")}function testaajax(){}