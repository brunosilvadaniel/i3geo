function ajaxhttp(){try{var objhttp1=new XMLHttpRequest()}catch(ee){try{var objhttp1=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{var objhttp1=new ActiveXObject("Microsoft.XMLHTTP")}catch(E){var objhttp1=false}}}return(objhttp1)}function ajaxexecAS(programa,funcao){var ohttp=ajaxhttp();ohttp.open("POST",programa,true);var retorno="";ohttp.onreadystatechange=function(){if(ohttp.readyState==4){retorno=ohttp.responseText;var reg=/Warning/gi;if(retorno.search(reg)!=-1){alert("OOps! Ocorreu um erro\n"+retorno);return}var reg=/erro/gi;if(retorno.search(reg)!=-1){alert("OOps! Ocorreu um erro\n"+retorno);return}if(funcao!="volta"){eval(funcao+'("'+retorno+'")')}}};ohttp.send(null)}function ajaxexec(programa,funcao){var objhttp=ajaxhttp();objhttp.open('GET',programa,false);objhttp.send(null);if(objhttp.status==200){if(funcao!="volta"){eval(funcao+'("'+objhttp.responseText+'")')}else{return objhttp.responseText}}}function ajaxexecASXml(programa,funcao){if(programa.search("http")==0){var h=window.location.host;if(programa.search(h)<0){alert("OOps! Nao e possivel chamar um XML de outro host.\nContacte o administrador do sistema.\nConfigure corretamente o ms_configura.php");return}}var ohttp=ajaxhttp();ohttp.open("GET",programa,true);var retorno="";ohttp.onreadystatechange=function(){if(ohttp.readyState==4){var retorno=ohttp.responseText;if(retorno!=undefined){if(document.implementation.createDocument){var parser=new DOMParser();var dom=parser.parseFromString(retorno,"text/xml")}else{var dom=new ActiveXObject("Microsoft.XMLDOM");dom.async="false";dom.load(programa)}}else{var dom="erro"}if(funcao!="volta"){eval(funcao+'(dom)')}else{return dom}}};ohttp.send(null)}function ajaxEscalaGrafica(retorno){if((retorno.data!="erro")&&(retorno.data!=undefined)){eval(retorno.data);if($i("imagemEscalaGrafica")){var m=new Image();m.src=scaimagem;$i("imagemEscalaGrafica").src=m.src;i3GEO.gadgets.quadros.grava("escala",scaimagem)}}}function ajaxLegendaHTML(retorno){if((retorno.data!="erro")&&(retorno.data!=undefined)){var s=i3GEO.configura.locaplic+"/imagens/solta.gif";$i("legenda").innerHTML="<img id=soltaLeg src="+s+" title='clique para liberar'/><br><div id='corpoLegi' >"+retorno.data.legenda+"</div>";g_legendaHTML=retorno.data.legenda;if($i("moveLegi")){$i("wlegenda").innerHTML=g_legendaHTML;var elementos=$i("wlegenda").getElementsByTagName("input");for(i=0;i<elementos.length;i++){elementos[i].style.display="none"}}$i("soltaLeg").onclick=function(){if(!$i("moveLegi")){var novoel=document.createElement("div");novoel.id="moveLegi";novoel.style.display="block";var temp='<div class="hd">Legenda</div>';temp+='<div id="wlegenda" style="text-align:left;background-color:white" >';temp+=g_legendaHTML+"</div>";novoel.innerHTML=temp;document.body.appendChild(novoel);var elementos=$i("wlegenda").getElementsByTagName("input");for(i=0;i<elementos.length;i++){elementos[i].style.display="none"}YAHOO.namespace("moveLegi.xp");YAHOO.moveLegi.xp.panel=new YAHOO.widget.Panel("moveLegi",{width:"300px",fixedcenter:true,constraintoviewport:false,underlay:"none",close:true,visible:true,draggable:true,modal:false})}YAHOO.moveLegi.xp.panel.render();YAHOO.moveLegi.xp.panel.show()};YAHOO.log("Concluída legenda HTML","redesenho")}else{YAHOO.log("Erro na legenda HTML","redesenho")}}function ajaxLegendaImagem(retorno){if((retorno.data!="erro")&&(retorno.data!=undefined)){eval(retorno.data);if($i("lugarquadros")){i3GEO.gadgets.quadros.grava("legenda",legimagem)}}}function ajaxCorpoMapa(retorno){i3GEO.arvoreDeCamadas.atualiza(retorno.data.temas);YAHOO.log("ajaxCorpoMapa","redesenho");if($i("mst")){$i("mst").style.display="block"}if(!$i("img")){return}try{i3GEO.janela.abreAguarde("ajaxCorpoMapa",$trad("o3"));if(retorno.data){var retorno=retorno.data}if(retorno.variaveis){var retorno=retorno.variaveis}if((retorno!="erro")&&(retorno!=undefined)){eval(retorno);$i("img").onload=function(){$i("img").onload="";i3GEO.gadgets.quadros.grava("imagem",mapimagem);if($i("banners")){$i("banners").style.height=objmapa.h}if($i("legenda")){$i("legenda").style.height=objmapa.h}i3GEO.janela.fechaAguarde("ajaxCorpoMapa");if($i("imgtemp")){$i("imgtemp").style.display="none"}if($i("imgClone"))$i("imgClone").style.display="none";$i("img").style.display="block";i3GEO.janela.fechaAguarde("ajaxCorpoMapa")};$i("img").src=mapimagem}else{calcposf();trataErro();alert("Erro no mapa")}g_recupera=0}catch(e){alert("Erro na funcao ajaxCorpoMapa: "+e);calcposf();trataErro();if(g_recupera==0){alert("Erro no mapa. Sera feita uma tentativa de recuperacao.");recuperamapa()}else{alert("Recuperacao impossivel. Sera feita uma tentativa de reiniciar o mapa.");if(g_recupera==1){g_recupera=2;var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=reiniciaMapa&g_sid="+i3GEO.configura.sid;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"recuperamapa",remapaf)}}}YAHOO.log("Fim ajaxCorpoMapa","redesenho")}function ajaxredesenha(retorno){try{richdraw.clearWorkspace()}catch(e){};try{i3GEO.gadgets.quadros.avanca();YAHOO.log("ajaxredesenha","redesenho");if(retorno&&retorno.data.temas){i3GEO.janela.abreAguarde("ajaxiniciaParametros",$trad("o1"));ajaxIniciaParametros(retorno)}else{var legimagem="";if($i("img")){i3GEO.janela.abreAguarde("ajaxiniciaParametros",$trad("o1"));var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=corpo&tipoimagem="+g_tipoimagem+"&g_sid="+i3GEO.configura.sid;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"redesenhaCorpo",ajaxIniciaParametros)}i3GEO.janela.fechaAguarde("ajaxredesenha");if($i("img_d")){$i("img_d").style.display="none"}g_destaca="";if($i("openlayers")){$i("openlayers").innerHTML="";var b=objmapa.OL.getExtent();criaOL(Math.random()+Math.random()+Math.random()+Math.random());objmapa.OL.zoomToExtent(b)}if($i("flamingo")){atualizaFL()}if($i("wdocai")&&$i("guia5obj")){var doc=(navm)?document.frames("wdocai").document:$i("wdocai").contentDocument;if(doc.getElementById("guia5obj")){if(doc.getElementById("guia5obj").style.display=="block"){if(window.parent.frames["wdocai"].atualizaGrafico){window.parent.frames["wdocai"].atualizaGrafico()}}}}}YAHOO.log("Fim ajaxredesenha","redesenho")}catch(e){alert("ajaxredesenha "+e)}}function ajaxIniciaParametros(retorno){YAHOO.log("ajaxIniciaParametros","redesenho");i3GEO.ajuda.ativaLetreiro(i3GEO.configura.locaplic,i3GEO.configura.sid);var tempo="";if($i("openlayers")){$i("openlayers").innerHTML="";var b=objmapa.OL.getExtent();criaOL(Math.random()+Math.random()+Math.random()+Math.random());objmapa.OL.zoomToExtent(b)}if($i("flamingo")){atualizaFL()}if(objmapa.objtips.length>0){var ot=objmapa.objtips.length-1;if(ot>=0){do{if(objmapa.objtips[ot]){document.body.removeChild(objmapa.objtips[ot])}}while(ot--)}}objmapa.objtips=new Array();limpacontainerf();try{if($i("imgL")){var letras=["N","S","L","O"];for(var l=0;l<4;l++){$i("img"+letras[l]).src=""}}mapscale="";mapexten="";eval(retorno.data.variaveis);if($i("img")){if(!$i("imgtemp")){var ndiv=document.createElement("div");ndiv.id="imgtemp";ndiv.style.position="absolute";ndiv.style.border="1px solid blue";document.getElementById("corpoMapa").appendChild(ndiv)}if(g_tipoacao=="pan"){$i("imgtemp").style.left=parseInt($i("img").style.left);$i("imgtemp").style.top=parseInt($i("img").style.top);$i("imgtemp").style.width=objmapa.w;$i("imgtemp").style.height=objmapa.h;$i("imgtemp").style.display="block";$i("imgtemp").style.backgroundImage='url("'+$i("img").src+'")'}$i("img").style.left=0;$i("img").style.top=0;ajaxCorpoMapa(retorno)}objmapa.atualizaLegendaHTML();i3GEO.arvoreDeCamadas.atualiza(retorno.data.temas);if(objmapa.scale!=mapscale)i3GEO.arvoreDeCamadas.atualizaFarol(mapscale);i3GEO.maparef.atualiza();objmapa.scale=mapscale;g_operacao="";i3GEO.arvoreDeCamadas.CAMADAS=retorno.data.temas;objmapa.cellsize=g_celula;objmapa.extent=mapexten;if($i("i3geo_escalanum")){$i("i3geo_escalanum").value=parseInt(mapscale)}if($i("mensagemt")){$i("mensagemt").value=mapexten}i3GEO.gadgets.quadros.grava("extensao",mapexten);i3GEO.janela.fechaAguarde("ajaxiniciaParametros");i3GEO.janela.fechaAguarde("aguardedoc");i3GEO.janela.fechaAguarde("ajaxredesenha");if(g_lenteaberta=="sim"){i3GEO.janela.abreAguarde("ajaxabrelente",$trad("o4"));var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=crialente&resolucao=1.5&g_sid="+i3GEO.configura.sid;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"lente",ajaxabrelente)}objmapa.verificaNavegaMapa();if(g_entorno=="sim"){geraURLentorno();ajustaEntorno()}YAHOO.log("Fim ajaxIniciaParametros","redesenho")}catch(e){alert("ajaxIniciaParametros "+e)}mostradicasf("","Tempo de redesenho em segundos: "+tempo,"")}function ajaxabrelente(retorno){try{YAHOO.log("ajaxabrelente","redesenho");var retorno=retorno.data;if(retorno=="erro"){alert("A lente nao pode ser criada");return}var volta=retorno.split(",");var nimg=volta[2];var olente=$i('lente');var oboxlente=$i('boxlente');var olenteimg=$i('lenteimg');olenteimg.src=nimg;olenteimg.style.width=volta[0]*1.5;olenteimg.style.height=volta[1]*1.5;olente.style.zIndex=1000;olenteimg.style.zIndex=1000;oboxlente.style.zIndex=1000;var pos=i3GEO.util.pegaPosicaoObjeto($i("corpoMapa"));eval("olente.style."+g_tipoleft+" = pos[0] + g_posicaoLenteX + g_postpx");eval("olente.style."+g_tipotop+" = pos[1] + g_posicaoLenteY + g_postpx");eval("oboxlente.style."+g_tipoleft+" = pos[0] + g_posicaoLenteX + g_postpx");eval("oboxlente.style."+g_tipotop+" = pos[1] + g_posicaoLenteY + g_postpx");oboxlente.style.display='block';oboxlente.style.visibility='visible';olente.style.display='block';olente.style.visibility='visible';i3GEO.janela.fechaAguarde("ajaxabrelente");YAHOO.log("Fim ajaxabrelente","redesenho")}catch(e){trataErro()}}function ajaxdestaca(retorno){YAHOO.log("ajaxdestaca","redesenho");var retorno=retorno.data;var m=new Image();m.src=retorno;if(!$i("img_d")){var novoel=document.createElement("div");novoel.id="div_d";document.body.appendChild(novoel);$i("div_d").innerHTML="<input style='position:relative;top:0px;left:0px'' type=image src='' id='img_d' />";$i("div_d").style.left=parseInt($i("corpoMapa").style.left);$i("div_d").style.top=parseInt($i("corpoMapa").style.top);$i("img_d").style.left=0;$i("img_d").style.top=0;$i("img_d").style.width=objmapa.w;$i("img_d").style.height=objmapa.h;$i("div_d").style.clip='rect(0 75 75 0)';$i("img_d").src=retorno;var novoeli=document.createElement("div");novoeli.id="div_di";novoel.appendChild(novoeli);$i("div_di").innerHTML="<p style='position:absolute;top:0px;left:0px'>+-</p>"}$i("div_d").innerHTML="";$i("div_d").style.display="block";var novoel=document.createElement("input");novoel.id="img_d";novoel.style.position="relative";novoel.style.top="0px";novoel.style.left="0px";novoel.type="image";novoel.src=m.src;novoel.style.display="block";$i("div_d").appendChild(novoel);i3GEO.janela.fechaAguarde("ajaxdestaca");YAHOO.log("Fim ajaxdestaca","redesenho")}function testaajax(){}