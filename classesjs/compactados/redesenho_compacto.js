function ajaxEscalaGrafica(retorno){if((retorno.data!="erro")&&(retorno.data!=undefined)){eval(retorno.data);if($i("imagemEscalaGrafica")){var m=new Image();m.src=scaimagem;$i("imagemEscalaGrafica").src=m.src;i3GEO.gadgets.quadros.grava("escala",scaimagem)}}}function ajaxCorpoMapa(retorno){i3GEO.arvoreDeCamadas.atualiza(retorno.data.temas);if($i("mst")){$i("mst").style.display="block"}if(objmapa.OL){$i("openlayers").innerHTML="";var b=objmapa.OL.getExtent();criaOL(Math.random()+Math.random()+Math.random()+Math.random());objmapa.OL.zoomToExtent(b)}if($i("flamingo")){atualizaFL();i3GEO.janela.fechaAguarde()}if(!$i("img")){return}try{i3GEO.janela.abreAguarde("ajaxCorpoMapa",$trad("o3"));if(retorno.data){var retorno=retorno.data}if(retorno.variaveis){var retorno=retorno.variaveis}if((retorno!="erro")&&(retorno!=undefined)){eval(retorno);$i("img").onload=function(){$i("img").onload="";i3GEO.gadgets.quadros.grava("imagem",mapimagem);var temp=function(retorno){eval(retorno.data);i3GEO.gadgets.quadros.grava("legenda",legimagem)};i3GEO.mapa.legendaIMAGEM.obtem(temp);if($i("banners")){$i("banners").style.height=objmapa.h}if($i("legenda")){$i("legenda").style.height=objmapa.h}if($i("imgtemp")){$i("imgtemp").style.display="none"}if($i("imgClone"))$i("imgClone").style.display="none";$i("img").style.display="block";i3GEO.janela.fechaAguarde("ajaxCorpoMapa")};$i("img").src=mapimagem}else{i3GEO.mapa.ajustaPosicao();i3GEO.janela.fechaAguarde();i3GEO.mapa.recupera.inicia()}i3GEO.mapa.recupera.TENTATIVA=0}catch(e){if(i3GEO.mapa.recupera.TENTATIVA==0){alert("Erro no mapa. Sera feita uma tentativa de recuperacao.");i3GEO.mapa.recupera.inicia()}else{alert("Recuperacao impossivel. Sera feita uma tentativa de reiniciar o mapa.");if(i3GEO.mapa.recupera.TENTATIVA==1){i3GEO.mapa.recupera.TENTATIVA=2;var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=reiniciaMapa&g_sid="+i3GEO.configura.sid;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"recuperamapa",ajaxredesenha)}}}}function ajaxredesenha(retorno){try{i3GEO.desenho.richdraw.clearWorkspace()}catch(e){};try{if(retorno&&retorno.data.temas){i3GEO.janela.abreAguarde("ajaxiniciaParametros",$trad("o1"));ajaxIniciaParametros(retorno)}else{var legimagem="";if($i("img")){i3GEO.janela.abreAguarde("ajaxiniciaParametros",$trad("o1"));var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=corpo&tipoimagem="+g_tipoimagem+"&g_sid="+i3GEO.configura.sid;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"redesenhaCorpo",ajaxIniciaParametros)}if($i("openlayers")){$i("openlayers").innerHTML="";var b=objmapa.OL.getExtent();criaOL(Math.random()+Math.random()+Math.random()+Math.random());objmapa.OL.zoomToExtent(b)}if($i("flamingo")){atualizaFL()}}}catch(e){alert("ajaxredesenha "+e)}}function ajaxIniciaParametros(retorno){var tempo="";try{mapscale="";mapexten="";eval(retorno.data.variaveis);if($i("img")){if(!$i("imgtemp")){var ndiv=document.createElement("div");ndiv.id="imgtemp";ndiv.style.position="absolute";ndiv.style.border="1px solid blue";document.getElementById("corpoMapa").appendChild(ndiv)}if(g_tipoacao=="pan"){$i("imgtemp").style.left=parseInt($i("img").style.left);$i("imgtemp").style.top=parseInt($i("img").style.top);$i("imgtemp").style.width=objmapa.w;$i("imgtemp").style.height=objmapa.h;$i("imgtemp").style.display="block";$i("imgtemp").style.backgroundImage='url("'+$i("img").src+'")'}$i("img").style.left=0;$i("img").style.top=0;ajaxCorpoMapa(retorno)}i3GEO.arvoreDeCamadas.atualiza(retorno.data.temas);if(objmapa.scale!=mapscale)i3GEO.arvoreDeCamadas.atualizaFarol(mapscale);objmapa.scale=mapscale;g_operacao="";i3GEO.arvoreDeCamadas.CAMADAS=retorno.data.temas;objmapa.cellsize=g_celula;objmapa.extent=mapexten;if($i("mensagemt")){$i("mensagemt").value=objmapa.extent}i3GEO.eventos.navegaMapa();if(i3GEO.configura.entorno=="sim"){i3GEO.navega.entorno.geraURL();i3GEO.navega.entorno.ajustaPosicao()}i3GEO.mapa.recupera.TENTATIVA=0}catch(e){if(i3GEO.mapa.recupera.TENTATIVA==0){alert("Erro no mapa. Sera feita uma tentativa de recuperacao.");i3GEO.mapa.recupera.inicia()}else{alert("Recuperacao impossivel. Sera feita uma tentativa de reiniciar o mapa.");if(i3GEO.mapa.recupera.TENTATIVA==1){i3GEO.mapa.recupera.TENTATIVA=2;var p=i3GEO.configura.locaplic+"/classesphp/mapa_controle.php?funcao=reiniciaMapa&g_sid="+i3GEO.configura.sid;var cp=new cpaint();cp.set_response_type("JSON");cp.call(p,"recuperamapa",ajaxredesenha)}}}i3GEO.ajuda.mostraJanela("Tempo de redesenho em segundos: "+tempo,"")}function testaajax(){}