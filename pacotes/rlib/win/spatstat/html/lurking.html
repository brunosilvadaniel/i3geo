<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><title>R: Lurking variable plot</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="../../R.css">
</head><body>

<table width="100%" summary="page for lurking {spatstat}"><tr><td>lurking {spatstat}</td><td align="right">R Documentation</td></tr></table>
<h2>Lurking variable plot</h2>


<h3>Description</h3>

<p>
Plot spatial point process residuals against a covariate
</p>


<h3>Usage</h3>

<pre>
lurking(object, covariate, type="eem",
                    cumulative=TRUE,
                    clipwindow=default.clipwindow(object),
                    rv,
                    plot.sd, plot.it=TRUE,
                    typename,
                    covname,
                    oldstyle=FALSE, ...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>object</code></td>
<td>
The fitted point process model (an object of class <code>"ppm"</code>)
for which diagnostics should be produced. This object
is usually obtained from <code><a href="ppm.html">ppm</a></code>.
</td></tr>
<tr valign="top"><td><code>covariate</code></td>
<td>
The covariate against which residuals should be plotted.
Either a numeric vector, a pixel image, or an <code>expression</code>.
See <EM>Details</EM> below.
</td></tr>
<tr valign="top"><td><code>type</code></td>
<td>
String indicating the type of residuals or weights to be computed.
Choices include <code>"eem"</code>,
<code>"raw"</code>, <code>"inverse"</code> and <code>"pearson"</code>.
See <code><a href="diagnose.ppm.html">diagnose.ppm</a></code> for all possible choices.
</td></tr>
<tr valign="top"><td><code>cumulative</code></td>
<td>
Logical flag indicating whether to plot a
cumulative sum of marks (<code>cumulative=TRUE</code>) or the derivative
of this sum, a marginal density of the smoothed residual field
(<code>cumulative=FALSE</code>).
</td></tr>
<tr valign="top"><td><code>clipwindow</code></td>
<td>
If not <code>NULL</code> this argument indicates that residuals shall
only be computed inside a subregion of the window containing the
original point pattern data. Then <code>clipwindow</code> should be
a window object of class <code>"owin"</code>.
</td></tr>
<tr valign="top"><td><code>rv</code></td>
<td>
Usually absent. 
If this argument is present, the values of the residuals will not be
calculated from the fitted model <code>object</code> but will instead
be taken directly from this vector.
</td></tr>
<tr valign="top"><td><code>plot.sd</code></td>
<td>
Logical value indicating whether 
error bounds should be added to plot.
The default is <code>TRUE</code> for Poisson models and
<code>FALSE</code> for non-Poisson models. See Details.
</td></tr>
<tr valign="top"><td><code>plot.it</code></td>
<td>
Logical value indicating whether 
plots should be shown. If <code>plot.it=FALSE</code>, only
the computed coordinates for the plots are returned.
See <EM>Value</EM>.
</td></tr>
<tr valign="top"><td><code>typename</code></td>
<td>
Usually absent. 
If this argument is present, it should be a string, and will be used
(in the axis labels of plots) to describe the type of residuals.
</td></tr>
<tr valign="top"><td><code>covname</code></td>
<td>
A string name for the covariate, to be used in axis labels of plots.
</td></tr>
<tr valign="top"><td><code>oldstyle</code></td>
<td>
Logical flag indicating whether error bounds should be plotted
using the approximation given in the original paper
(<code>oldstyle=TRUE</code>),
or using the correct asymptotic formula (<code>oldstyle=FALSE</code>).
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
Arguments passed to <code>smooth.spline</code> for the estimation of the
derivatives in the case <code>cumulative=FALSE</code>.
</td></tr>
</table>

<h3>Details</h3>

<p>
This function generates a `lurking variable' plot for a
fitted point process model. 
Residuals from the model represented by <code>object</code>
are plotted against the covariate specified by <code>covariate</code>.
This plot can be used to reveal departures from the fitted model,
in particular, to reveal that the point pattern depends on the covariate.
</p>
<p>
First the residuals from the fitted model (Baddeley et al, 2004)
are computed at each quadrature point,
or alternatively the `exponential energy marks' (Stoyan and Grabarnik,
1991) are computed at each data point.
The argument <code>type</code> selects the type of
residual or weight. See <code><a href="diagnose.ppm.html">diagnose.ppm</a></code> for options
and explanation.
</p>
<p>
A lurking variable plot for point processes (Baddeley et al, 2004)
displays either the cumulative sum of residuals/weights
(if <code>cumulative = TRUE</code>) or a kernel-weighted average of the
residuals/weights (if <code>cumulative = FALSE</code>) plotted against
the covariate. The empirical plot (solid lines) is shown
together with its expected value assuming the model is true
(dashed lines) and optionally also the pointwise
two-standard-deviation limits (dotted lines).
</p>
<p>
To be more precise, let <i>Z(u)</i> denote the value of the covariate
at a spatial location <i>u</i>. 
<ul>
<li>If <code>cumulative=TRUE</code> then we plot <i>H(z)</i> against <i>z</i>,
where <i>H(z)</i> is the sum of the residuals 
over all quadrature points where the covariate takes
a value less than or equal to <i>z</i>, or the sum of the
exponential energy weights over all data points where the covariate
takes a value less than or equal to <i>z</i>.
<li>If <code>cumulative=FALSE</code> then we plot <i>h(z)</i> against <i>z</i>,
where <i>h(z)</i> is the derivative of <i>H(z)</i>,
computed approximately by spline smoothing.
</ul>
<p>
For the point process residuals <i>E(H(z)) = 0</i>,
while for the exponential energy weights
<i>E(H(z)) = </i> area of the subset of the window 
satisfying <i>Z(u) &lt;= z</i>. 
</p>
<p>
If the empirical and theoretical curves deviate substantially
from one another, the interpretation is that the fitted model does
not correctly account for dependence on the covariate.
The correct form (of the spatial trend part of the model)
may be suggested by the shape of the plot.
</p>
<p>
If <code>plot.sd = TRUE</code>, then superimposed on the lurking variable
plot are the pointwise
two-standard-deviation error limits for <i>H(x)</i> calculated for the
inhomogeneous Poisson process. The default is <code>plot.sd = TRUE</code>
for Poisson models and <code>plot.sd = FALSE</code> for non-Poisson
models.
</p>
<p>
By default, the two-standard-deviation limits are calculated
from the exact formula for the asymptotic variance
of the residuals under the asymptotic normal approximation,
equation (37) of Baddeley et al (2006).
However, for compatibility with the original paper
of Baddeley et al (2005), if <code>oldstyle=TRUE</code>,
the two-standard-deviation limits are calculated
using the innovation variance, an over-estimate of the true
variance of the residuals.
</p>
<p>
The argument <code>object</code> must be a fitted point process model
(object of class <code>"ppm"</code>) typically produced by the maximum
pseudolikelihood fitting algorithm <code><a href="ppm.html">ppm</a></code>).
</p>
<p>
The argument <code>covariate</code> is either a numeric vector, a pixel
image, or an R language expression.
If it is a numeric vector, it is assumed to contain
the values of the covariate for each of the quadrature points
in the fitted model. The quadrature points can be extracted by
<code><a href="quad.ppm.html">quad.ppm</a>(object)</code>.
</p>
<p>
If <code>covariate</code> is a pixel image, it is assumed to contain the
values of the covariate at each location in the window. The values of
this image at the quadrature points will be extracted.
</p>
<p>
Alternatively, if <code>covariate</code>
is an <code>expression</code>, it will be evaluated in the same environment
as the model formula used in fitting the model <code>object</code>. It must
yield a vector of the same length as the number of quadrature points.
The expression may contain the terms <code>x</code> and <code>y</code> representing the
cartesian coordinates, and may also contain other variables that were
available when the model was fitted. Certain variable names are
reserved words; see <code><a href="ppm.html">ppm</a></code>.
</p>
<p>
Note that lurking variable plots for the <i>x</i> and <i>y</i> coordinates
are also generated by <code><a href="diagnose.ppm.html">diagnose.ppm</a></code>, amongst other
types of diagnostic plots. This function is more general in that it
enables the user to plot the residuals against any chosen covariate
that may have been present.
</p>


<h3>Value</h3>

<p>
A list containing two dataframes
<code>empirical</code> and <code>theoretical</code>. 
The first dataframe <code>empirical</code> contains columns
<code>covariate</code> and <code>value</code> giving the coordinates of the
lurking variable plot. The second dataframe <code>theoretical</code>
contains columns <code>covariate</code>, <code>mean</code> and <code>sd</code>
giving the coordinates of the plot of the theoretical mean
and standard deviation.</p>

<h3>References</h3>

<p>
Baddeley, A., Turner, R., Moller, J. and Hazelton, M. (2005)
Residual analysis for spatial point processes.
<EM>Journal of the Royal Statistical Society, Series B</EM>
<B>67</B>, 617&ndash;666.
</p>
<p>
Baddeley, A., Moller, J. and Pakes, A.G. (2006)
Properties of residuals for spatial point processes.
To appear.
</p>
<p>
Stoyan, D. and Grabarnik, P. (1991)
Second-order characteristics for stochastic structures connected with
Gibbs point processes.
<EM>Mathematische Nachrichten</EM>, 151:95&ndash;100.
</p>


<h3>See Also</h3>

<p>
<code><a href="residuals.ppm.html">residuals.ppm</a></code>,
<code><a href="diagnose.ppm.html">diagnose.ppm</a></code>,
<code><a href="residuals.ppm.html">residuals.ppm</a></code>,
<code><a href="qqplot.ppm.html">qqplot.ppm</a></code>,
<code><a href="eem.html">eem</a></code>,
<code><a href="ppm.html">ppm</a></code>
</p>


<h3>Examples</h3>

<pre>
  data(nztrees)
  fit &lt;- ppm(nztrees, ~x, Poisson())
  lurking(fit, expression(x))
  lurking(fit, expression(x), cumulative=FALSE)
</pre>



<hr><div align="center">[Package <em>spatstat</em> version 1.10-3 <a href="00Index.html">Index]</a></div>

</body></html>
