<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><title>R: Apply Function to Every Neighbourhood in a Point Pattern</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="../../R.css">
</head><body>

<table width="100%" summary="page for applynbd {spatstat}"><tr><td>applynbd {spatstat}</td><td align="right">R Documentation</td></tr></table>
<h2>Apply Function to Every Neighbourhood in a Point Pattern</h2>


<h3>Description</h3>

<p>
Visit each point in a point pattern, find the neighbouring points,
and apply a given function to them.
</p>


<h3>Usage</h3>

<pre>
   applynbd(X, FUN, N, R, criterion, exclude=FALSE, ...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>X</code></td>
<td>
Point pattern. 
An object of class <code>"ppp"</code>,
or data which can be converted into 
this format by <code><a href="as.ppp.html">as.ppp</a></code>.
</td></tr>
<tr valign="top"><td><code>FUN</code></td>
<td>
Function to be applied to each neighbourhood.
The arguments of <code>FUN</code> are described under <B>Details</B>.
</td></tr>
<tr valign="top"><td><code>N</code></td>
<td>
Integer. If this argument is present,
the neighbourhood of a point of <code>X</code> is defined to consist of the
<code>N</code> points of <code>X</code> which are closest to it.
This argument is incompatible with <code>R</code> and <code>criterion</code>.
</td></tr>
<tr valign="top"><td><code>R</code></td>
<td>
Nonnegative numeric value. If this argument is present,
the neighbourhood of a point of <code>X</code> is defined to consist of
all points of <code>X</code> which lie within a distance <code>R</code>
of it.
This argument is incompatible with <code>N</code> and <code>criterion</code>.
</td></tr>
<tr valign="top"><td><code>criterion</code></td>
<td>
Function. If this argument is present, 
the neighbourhood of a point of <code>X</code> is determined by
evaluating this function. See under <B>Details</B>.
This argument is incompatible with <code>N</code> and <code>R</code>.
</td></tr>
<tr valign="top"><td><code>exclude</code></td>
<td>
Logical. If <code>TRUE</code> then the point currently being visited
is excluded from its own neighbourhood.
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
extra arguments passed to the function <code>FUN</code>.
They must be given in the form <code>name=value</code>.
</td></tr>
</table>

<h3>Details</h3>

<p>
This is an analogue of <code><a href="../../base/html/apply.html">apply</a></code>
for point patterns. It visits each point in the point pattern <code>X</code>,
determines which points of <code>X</code> are ``neighbours'' of the current
point, applies the function <code>FUN</code> to this neighbourhood,
and collects the values returned by <code>FUN</code>.
</p>
<p>
The definition of ``neighbours'' depends on the arguments
<code>N</code>, <code>R</code> and <code>criterion</code>, exactly one of which
must be given.
Also the argument <code>exclude</code> determines whether
the current point is excluded from its own neighbourhood.
</p>
<p>
If <code>N</code> is given, then the neighbours of the current
point are the <code>N</code> points of <code>X</code> which are closest to
the current point (including the current point itself
unless <code>exclude=TRUE</code>).
If <code>R</code> is given, then the neighbourhood of the current point
consists of all points of <code>X</code> which lie closer than a distance <code>R</code>
from the current point.
If <code>criterion</code> is given, then it must be a function
with two arguments <code>dist</code> and <code>drank</code> which will be
vectors of equal length.
The interpretation is that <code>dist[i]</code> will be the
distance of a point from the current point, and
<code>drank[i]</code> will be the rank of that distance (the three points
closest to the current point will have rank 1, 2 and 3).
This function must return a logical vector of the same length
as <code>dist</code> and <code>drank</code> whose <code>i</code>-th entry is
<code>TRUE</code> if the corresponding point should be included in
the neighbourhood. See the examples below.
</p>
<p>
Each point of <code>X</code> is visited; the neighbourhood
of the current point is determined, and stored as a point pattern
<code>Y</code>; then the function <code>FUN</code> is called as:
</p>
<p>
<code>FUN(Y=Y, current=current, dists=dists, dranks=dranks, ...)</code>
</p>
<p>
where <code>current</code> is a vector of length 2 giving the coordinates of the
current point, <code>dists</code> is a vector of distances from the current
point to each of the points in <code>Y</code>, 
<code>dranks</code> is a vector of the ranks of these distances
with respect to the full point pattern <code>X</code>,
and <code>...</code> are the arguments passed from the call to
<code>applynbd</code>.
</p>
<p>
The results of each call to <code>FUN</code> are collected and returned
according to the usual rules for <code><a href="../../base/html/apply.html">apply</a></code> and its
relatives. See <B>Value</B> above.
</p>
<p>
Note that <code>FUN</code> will be called exactly as described above,
with each argument named explicitly. Care is required when writing the
function <code>FUN</code> to ensure that
the arguments will match up. See the Examples.
</p>
<p>
See <code><a href="markstat.html">markstat</a></code> for a common use of this function.
</p>


<h3>Value</h3>

<p>
Similar to the result of <code><a href="../../base/html/apply.html">apply</a></code>.
If each call to <code>FUN</code> returns a single numeric value,
the result is a vector of dimension <code>X$n</code>, the number of points
in <code>X</code>.
If each call to <code>FUN</code> returns a vector of the same length
<code>m</code>, then the result is a matrix of dimensions <code>c(m,n)</code>;
note the transposition of the indices, as usual for the family of
<code>apply</code> functions.
If the calls to <code>FUN</code> return vectors of different lengths,
the result is a list of length <code>X$n</code>.</p>

<h3>Author(s)</h3>

<p>
Adrian Baddeley
<a href="mailto:adrian@maths.uwa.edu.au">adrian@maths.uwa.edu.au</a>
<a href="http://www.maths.uwa.edu.au/~adrian/">http://www.maths.uwa.edu.au/~adrian/</a>
and Rolf Turner
<a href="mailto:rolf@math.unb.ca">rolf@math.unb.ca</a>
<a href="http://www.math.unb.ca/~rolf">http://www.math.unb.ca/~rolf</a>
</p>


<h3>See Also</h3>

<p>
<code><a href="ppp.object.html">ppp.object</a></code>,
<code><a href="../../base/html/apply.html">apply</a></code>,
<code><a href="markstat.html">markstat</a></code>
</p>


<h3>Examples</h3>

<pre>
  data(redwood)

  # count the number of points within radius 0.2 of each point of X
  nneighbours &lt;- applynbd(redwood, R=0.2, function(Y, ...){Y$n-1})
  # equivalent to:
  nneighbours &lt;- applynbd(redwood, R=0.2, function(Y, ...){Y$n}, exclude=TRUE)

  # compute the distance to the second nearest neighbour of each point
  secondnndist &lt;- applynbd(redwood, N = 2,
                           function(dists, ...){max(dists)},
                           exclude=TRUE)

  # marked point pattern
  data(longleaf)
  
  # compute the median of the marks of all neighbours of a point
  # (see also 'markstat')
  dbh.med &lt;- applynbd(longleaf, R=90, exclude=TRUE,
                 function(Y, ...) { median(Y$marks)})

  # ANIMATION explaining the definition of the K function
  # (arguments `fullpicture' and 'rad' are passed to FUN)

  ## Not run: 
  showoffK &lt;- function(Y, current, dists, dranks, fullpicture,rad) { 
        plot(fullpicture, main="")
        points(Y, cex=2)
        u &lt;- current
        points(u[1],u[2],pch="+",cex=3)
        theta &lt;- seq(0,2*pi,length=100)
        polygon(u[1]+ rad * cos(theta),u[2]+rad*sin(theta))
        text(u[1]+rad/3,u[2]+rad/2,Y$n,cex=3)
        Sys.sleep(if(runif(1) &lt; 0.1) 1.5 else 0.3)
        return(Y$n - 1)
  }
  applynbd(redwood, R=0.2, showoffK, fullpicture=redwood, rad=0.2, exclude=TRUE)

  # animation explaining the definition of the G function

  showoffG &lt;- function(Y, current, dists, dranks, fullpicture) { 
        plot(fullpicture, main="")
        points(Y, cex=2)
        u &lt;- current
        points(u[1],u[2],pch="+",cex=3)
        v &lt;- c(Y$x[1],Y$y[1])
        segments(u[1],u[2],v[1],v[2],lwd=2)
        w &lt;- (u + v)/2
        nnd &lt;- dists[1]
        text(w[1],w[2],round(nnd,3),cex=2)
        Sys.sleep(if(runif(1) &lt; 0.1) 1.5 else 0.3)
        return(nnd)
  }

  data(cells)
  applynbd(cells, N=1, showoffG, exclude=TRUE, fullpicture=cells)
  ## End(Not run)
</pre>



<hr><div align="center">[Package <em>spatstat</em> version 1.10-3 <a href="00Index.html">Index]</a></div>

</body></html>
