def.type('pvc.data.LinearInterpolationOperSeriesState').init(function(interpolation,serIndex){this.interpolation=interpolation;this.index=serIndex;this._lastNonNull(null)}).add({visit:function(catSeriesInfo){if(catSeriesInfo.isNull){this._interpolate(catSeriesInfo)}else{this._lastNonNull(catSeriesInfo)}},_lastNonNull:function(catSerInfo){if(arguments.length){this.__lastNonNull=catSerInfo;this.__nextNonNull=undefined}return this.__lastNonNull},_nextNonNull:function(){return this.__nextNonNull},_initInterpData:function(){if(this.__nextNonNull!==undefined){return}var last=this.__lastNonNull;var next=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||null;if(next&&last){var fromValue=last.value;var toValue=next.value;var deltaValue=toValue-fromValue;if(this.interpolation._isCatDiscrete){var stepCount=next.catInfo.index-last.catInfo.index;(stepCount>=2)||def.assert("Must have at least one interpolation point.");this._stepValue=deltaValue/stepCount;this._middleIndex=~~(stepCount/2); var dotCount=(stepCount-1);this._isOdd=(dotCount%2)>0}else{var fromCat=+last.catInfo.value;var toCat=+next.catInfo.value;var deltaCat=toCat-fromCat;this._steep=deltaValue/deltaCat; this._middleCat=(toCat+fromCat)/2}}},_interpolate:function(catSerInfo){this._initInterpData();var next=this.__nextNonNull;var last=this.__lastNonNull;var one=next||last;if(!one){return}var value,group;var interpolation=this.interpolation;var catInfo=catSerInfo.catInfo;if(next&&last){if(interpolation._isCatDiscrete){var groupIndex=(catInfo.index-last.catInfo.index);value=last.value+this._stepValue*groupIndex;if(this._isOdd){group=groupIndex<this._middleIndex?last.group:next.group}else{group=groupIndex<=this._middleIndex?last.group:next.group}}else{var cat=+catInfo.value;var lastCat=+last.catInfo.value;value=last.value+this._steep*(cat-lastCat);group=cat<this._middleCat?last.group:next.group}}else{if(!interpolation._stretchEnds){return}value=one.value;group=one.group}var atoms=Object.create(group._datums[0].atoms);def.copyOwn(atoms,catInfo.data.atoms);var valueAtom=interpolation._valDim.intern(value,true);atoms[valueAtom.dimension.name]=valueAtom;var newDatum=new pvc.data.Datum(group.owner,atoms);newDatum.isVirtual=true;newDatum.isInterpolated=true;newDatum.interpolation='linear';interpolation._newDatums.push(newDatum)}});