def.type('pvc.WaterfallChart',pvc.BarAbstract).init(function(options){this.base(options);var parent=this.parent;if(parent){this._isFalling=parent._isFalling}}).add({_animatable:true,_isFalling:true,_ruleInfos:null,_waterColor:pv.color("#1f77b4").darker(),_processOptionsCore:function(options){options.stacked=true;options.baseAxisComposite=false;this.base(options);options.plot2=false},_initPlotsCore:function(){var options=this.options;var waterPlot=new pvc.visual.WaterfallPlot(this);this._isFalling=waterPlot.option('Direction')==='down';this._catRole.setFlatteningMode(this._isFalling?'tree-pre':'tree-post');this._catRole.setFlattenRootLabel(this.plots.water.option('AllCategoryLabel'))},_initLegendScenes:function(legendPanel){var waterPlot=this.plots.water;var extAbsId=pvc.makeExtensionAbsId('line',waterPlot.extensionPrefixes);var strokeStyle=this._getConstantExtension(extAbsId,"strokeStyle");if(strokeStyle){this._waterColor=pv.color(strokeStyle)}var rootScene=legendPanel._getBulletRootScene();new pvc.visual.legend.WaterfallBulletGroupScene(rootScene,{extensionPrefix:pvc.buildIndexedId('',1),label:waterPlot.option('TotalLineLabel'),color:this._waterColor});this.base(legendPanel)},_reduceStackedCategoryValueExtent:function(result,catRange,catGroup){var offset;if(!result){if(catRange){offset=catRange.min+catRange.max;this._ruleInfos=[{offset:offset,group:catGroup,range:catRange}];return{min:catRange.min,max:catRange.max,offset:offset}}return null}offset=result.offset;if(this._isFalling){this._ruleInfos.push({offset:offset,group:catGroup,range:catRange})}if(!catGroup._isFlattenGroup||catGroup._isDegenerateFlattenGroup){var dir=this._isFalling?-1:1;offset=result.offset=offset+dir*(catRange.min+catRange.max);if(offset>result.max){result.max=offset}if(offset<result.min){result.min=offset}}if(!this._isFalling){this._ruleInfos.push({offset:offset,group:catGroup,range:catRange})}return result},_createPlotPanels:function(parentPanel,baseOptions){this.wfChartPanel=new pvc.WaterfallPanel(this,parentPanel,this.plots.water,def.create(baseOptions,{waterfall:this.options.waterfall}))}});