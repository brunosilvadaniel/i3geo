def.type('pvc.visual.Sign',pvc.visual.BasicSign).init(function(panel,pvMark,keyArgs){this.base(panel,pvMark,keyArgs);this.bits=0;var extensionIds=def.get(keyArgs,'extensionId');if(extensionIds!=null){this.extensionAbsIds=def.array.to(panel._makeExtensionAbsId(extensionIds))}this.isActiveSeriesAware=def.get(keyArgs,'activeSeriesAware',true)&&!!this.chart.visualRoles('series',{assertExists:false});var wrapper=def.get(keyArgs,'wrapper');if(!wrapper){wrapper=function(f){return function(scene){return f.call(panel._getContext(pvMark),scene)}}}pvMark.wrapper(wrapper);if(!def.get(keyArgs,'freeColor',true)){this._bindProperty('fillStyle','fillColor','color')._bindProperty('strokeStyle','strokeColor','color')}}).postInit(function(panel,pvMark,keyArgs){panel._addSign(this);this._addInteractive(keyArgs)}).add({property:function(name){var upperName=def.firstUpperCase(name);var baseName='base'+upperName;var defName='default'+upperName;var normalName='normal'+upperName;var interName='interactive'+upperName;var methods={};methods[name]=function(arg){delete this._finished;var value;this._arg=arg;try{value=this[baseName](arg);if(value==null){return null}if(this.hasOwnProperty('_finished')){return value}if(this.showsInteraction()&&this.scene.anyInteraction()){value=this[interName](value,arg)}else{value=this[normalName](value,arg)}}finally{delete this._arg}return value};methods[baseName]=function(arg){return this.delegateExtension()};methods[defName]=function(arg){return};methods[normalName]=function(value,arg){return value};methods[interName]=function(value,arg){return value};this.constructor.add(methods);return this},finished:function(value){this._finished=true;return value},applyExtensions:function(){if(!this._extended){this._extended=true;var extensionAbsIds=this.extensionAbsIds;if(extensionAbsIds){extensionAbsIds.forEach(function(extensionAbsId){this.panel.extendAbs(this.pvMark,extensionAbsId)},this)}}return this},intercept:function(name,fun){return this._intercept(name,fun.bind(this))},lockDimensions:function(){this.pvMark.lock('left').lock('right').lock('top').lock('bottom').lock('width').lock('height');return this},_extensionKeyArgs:{tag:pvc.extensionTag},_bindProperty:function(pvName,prop,realProp){var me=this;if(!realProp){realProp=prop}var defaultPropName="default"+def.firstUpperCase(realProp);if(def.fun.is(this[defaultPropName])){if(!this.pvMark.hasDelegateValue(pvName,pvc.extensionTag)){var defaultMethodCaller=function(){return me[defaultPropName](me._arg)};this.pvMark.intercept(pvName,defaultMethodCaller,this._extensionKeyArgs)}}function mainMethodCaller(){return me[prop]()}return this._intercept(pvName,mainMethodCaller)},_intercept:function(name,fun){var mark=this.pvMark;var extensionAbsIds=this.extensionAbsIds;if(extensionAbsIds){def.query(extensionAbsIds).select(function(extensionAbsId){return this.panel._getExtensionAbs(extensionAbsId,name)},this).where(def.notUndef).each(function(extValue){extValue=mark.wrap(extValue,name);mark.intercept(name,extValue,this._extensionKeyArgs)},this)}(mark._intercepted||(mark._intercepted={}))[name]=true;mark.intercept(name,fun);return this}}).prototype.property('color').constructor.add({_bitShowsActivity:2,_bitShowsSelection:4,_bitShowsInteraction:4|2,_bitShowsTooltip:8,_bitSelectable:16,_bitHoverable:32,_bitClickable:64,_bitDoubleClickable:128,showsInteraction:function(){return(this.bits&this._bitShowsInteraction)!==0},showsActivity:function(){return(this.bits&this._bitShowsActivity)!==0},showsSelection:function(){return(this.bits&this._bitShowsSelection)!==0},showsTooltip:function(){return(this.bits&this._bitShowsTooltip)!==0},isSelectable:function(){return(this.bits&this._bitSelectable)!==0},isHoverable:function(){return(this.bits&this._bitHoverable)!==0},isClickable:function(){return(this.bits&this._bitClickable)!==0},isDoubleClickable:function(){return(this.bits&this._bitDoubleClickable)!==0},extensionAbsIds:null,_addInteractive:function(keyArgs){var panel=this.panel,pvMark=this.pvMark,chart=this.chart,options=chart.options;var bits=this.bits;bits|=this._bitShowsInteraction;if(chart._tooltipEnabled&&!def.get(keyArgs,'noTooltip')){bits|=this._bitShowsTooltip;this.panel._addPropTooltip(pvMark,def.get(keyArgs,'tooltipArgs'))}var clickSelectable=false;var clickable=false;if(options.selectable||options.hoverable){if(options.selectable&&!def.get(keyArgs,'noSelect')){bits|=this._bitSelectable;clickSelectable=!def.get(keyArgs,'noClickSelect')&&chart._canSelectWithClick()}if(options.hoverable&&!def.get(keyArgs,'noHover')){bits|=this._bitHoverable;panel._addPropHoverable(pvMark)}}var showsInteraction=def.get(keyArgs,'showsInteraction');if(showsInteraction!=null){if(showsInteraction){bits|=this._bitShowsInteraction}else{bits&=~this._bitShowsInteraction}}var showsActivity=def.get(keyArgs,'showsActivity');if(showsActivity!=null){if(showsActivity){bits|=this._bitShowsActivity}else{bits&=~this._bitShowsActivity}}var showsSelection=def.get(keyArgs,'showsSelection');if(showsSelection!=null){if(showsSelection){bits|=this._bitShowsSelection}else{bits&=~this._bitShowsSelection}}if(!def.get(keyArgs,'noClick')&&panel._isClickable()){bits|=this._bitClickable;clickable=true}if(clickSelectable||clickable){panel._addPropClick(pvMark)}if(!def.get(keyArgs,'noDoubleClick')&&panel._isDoubleClickable()){bits|=this._bitDoubleClickable;panel._addPropDoubleClick(pvMark)}this.bits=bits},fillColor:function(){return this.color('fill')},strokeColor:function(){return this.color('stroke')},defaultColor:function(){return this.defaultColorSceneScale()(this.scene)},dimColor:function(color){return pvc.toGrayScale(color,-0.3,null,null)},_initDefaultColorSceneScale:function(){var colorAxis=this.panel.axes.color;return colorAxis?colorAxis.sceneScale({nullToZero:false}):def.fun.constant(pvc.defaultColor)},defaultColorSceneScale:function(){return this._defaultColorSceneScale||(this._defaultColorSceneScale=this._initDefaultColorSceneScale())}});