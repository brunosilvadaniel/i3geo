def.scope(function(){def.type('pvc.visual.ColorAxis',pvc.visual.Axis).add({scaleNullRangeValue:function(){return this.option('Missing')||null},scaleUsesAbs:function(){return this.option('UseAbs')},bind:function(dataCells){this.base(dataCells);this._plotList=def.query(dataCells).select(function(dataCell){return dataCell.plot}).distinct(function(plot){return plot&&plot.id}).array();return this},calculateScale:function(){var scale,noWrap;var dataCells=this.dataCells;if(dataCells){var chart=this.chart;if(this.scaleType==='discrete'){var domainValues=def.query(dataCells).selectMany(function(dataCell){var role=dataCell.role;if(role&&role.isBound()){var partData=chart.partData(dataCell.dataPartValue);var domainData=partData&&partData.flattenBy(role);dataCell.data=domainData;return domainData&&domainData.children()}}).distinct(function(child){return child.key}).select(function(child){return def.nullyTo(child.value,'')}).array();this.domainValues=domainValues;scale=this.scheme()(domainValues);noWrap=true}else{if(dataCells.length===1){var visibleDomainData=chart.root.visibleData(this.dataCell.dataPartValue);var normByCateg=this.option('NormByCategory');var scaleOptions={type:this.option('ScaleType'),colors:this.option('Colors')().range(),colorDomain:this.option('Domain'),colorMin:this.option('Min'),colorMax:this.option('Max'),colorNull:this.option('Missing'),data:visibleDomainData,colorDimension:this.role.firstDimensionName(),normPerBaseCategory:normByCateg};if(normByCateg){this.scalesByCateg=pvc.color.scales(scaleOptions)}else{scale=pvc.color.scale(scaleOptions)}}}}this.setScale(scale,noWrap);return this},_wrapScale:function(scale){var applyTransf;if(this.scaleType==='discrete'){applyTransf=this.option.isSpecified('Transform')||(!this.option.isSpecified('Colors')&&!this.option.isSpecified('Map'))}else{applyTransf=true}if(applyTransf){var colorTransf=this.option('Transform');if(colorTransf){scale=scale.transform(colorTransf)}}return this.base(scale)},scheme:function(){return def.lazy(this,'_scheme',this._createScheme,this)},_createColorMapFilter:function(colorMap){var fixedColors=def.uniqueIndex(colorMap,function(c){return c.key});return{domain:function(k){return!def.hasOwn(colorMap,k)},color:function(c){return!def.hasOwn(fixedColors,c.key)}}},_createScheme:function(){var me=this;var baseScheme=me.option('Colors');if(me.scaleType!=='discrete'){return function(d){var scale=baseScheme.apply(null,arguments);return me._wrapScale(scale)}}var colorMap=me.option('Map');if(!colorMap){return function(d){var scale=baseScheme.apply(null,arguments);return me._wrapScale(scale)}}var filter=this._createColorMapFilter(colorMap);return function(d){var scale;if(!(d instanceof Array)){d=def.array.copy(arguments)}d=d.filter(filter.domain);var baseScale=baseScheme(d);var r=baseScale.range().filter(filter.color);baseScale.range(r);scale=function(k){var c=def.getOwn(colorMap,k);return c||baseScale(k)};def.copy(scale,baseScale);var dx,rx;scale.domain=function(){if(arguments.length){throw def.operationInvalid("The scale cannot be modified.")}if(!dx){dx=def.array.append(def.ownKeys(colorMap),d)}return dx};scale.range=function(){if(arguments.length){throw def.operationInvalid("The scale cannot be modified.")}if(!rx){rx=def.array.append(def.own(colorMap),d)}return rx};return me._wrapScale(scale)}},sceneScale:function(keyArgs){var varName=def.get(keyArgs,'sceneVarName')||this.role.name;return this.scale.by1(function(scene){return scene.vars[varName].value})},_buildOptionId:function(){return this.id+"Axis"},_getOptionsDefinition:function(){return colorAxis_optionsDef},_resolveByNaked:pvc.options.specify(function(optionInfo){if(!this.index){return this._chartOption(this.id+def.firstUpperCase(optionInfo.name))}}),_specifyV1ChartOption:function(optionInfo,asName){if(!this.index&&this.chart.compatVersion()<=1&&this._specifyChartOption(optionInfo,asName)){return true}}});function castSize(size){if(!def.object.is(size)){var position=this.option('Position');size=new pvc.Size().setSize(size,{singleProp:pvc.BasePanel.orthogonalLength[position]})}return size}function castAlign(align){var position=this.option('Position');return pvc.parseAlign(position,align)}function castColorMap(colorMap){var resultMap;if(colorMap){var any;def.eachOwn(colorMap,function(v,k){any=true;colorMap[k]=pv.color(v)});if(any){resultMap=colorMap}}return resultMap}var legendData={resolveDefault:function(optionInfo){if(!this.index&&this._specifyChartOption(optionInfo,def.firstLowerCase(optionInfo.name))){return true}}};function getDefaultColor(optionInfo){var colors;if(this.scaleType==='discrete'){if(this.index===0){colors=pvc.createColorScheme()}else{var me=this;colors=function(){return me.chart._getRoleColorScale(me.role.name)}}}else{colors=['red','yellow','green'].map(function(name){return pv.Color.names[name]})}return colors}var colorAxis_optionsDef=def.create(axis_optionsDef,{Colors:{resolve:'_resolveFull',getDefault:getDefaultColor,data:{resolveV1:function(optionInfo){if(this.scaleType==='discrete'){if(this.index===0){this._specifyChartOption(optionInfo,'colors')}else if(this.index===1&&this.chart._allowV1SecondAxis){this._specifyChartOption(optionInfo,'secondAxisColor')}}else{this._specifyChartOption(optionInfo,'colorRange')}return true},resolveDefault:function(optionInfo){if(this.index===0){this._specifyChartOption(optionInfo,'colors')}}},cast:pvc.colorScheme},Map:{resolve:'_resolveFull',cast:castColorMap},Transform:{resolve:'_resolveFull',data:{resolveDefault:function(optionInfo){var plotList=this._plotList;if(plotList.length<=2){var onlyTrendAndPlot2=def.query(plotList).all(function(plot){var name=plot.name;return(name==='plot2'||name==='trend')});if(onlyTrendAndPlot2){optionInfo.defaultValue(pvc.brighterColorTransform);return true}}}},cast:def.fun.to},NormByCategory:{resolve:function(optionInfo){if(!this.chart._allowColorPerCategory){optionInfo.specify(false);return true}return this._resolveFull(optionInfo)},data:{resolveV1:function(optionInfo){this._specifyV1ChartOption(optionInfo,'normPerBaseCategory');return true}},cast:Boolean,value:false},ScaleType:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){this._specifyV1ChartOption(optionInfo,'scalingType');return true}},cast:pvc.parseContinuousColorScaleType,value:'linear'},UseAbs:{resolve:'_resolveFull',cast:Boolean,value:false},Domain:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){this._specifyV1ChartOption(optionInfo,'colorRangeInterval');return true}},cast:def.array.to},Min:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){this._specifyV1ChartOption(optionInfo,'minColor');return true}},cast:pv.color},Max:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){this._specifyV1ChartOption(optionInfo,'maxColor');return true}},cast:pv.color},Missing:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){this._specifyV1ChartOption(optionInfo,'nullColor');return true}},cast:pv.color,value:pv.color("#efc5ad")},LegendVisible:{resolve:'_resolveFull',data:legendData,cast:Boolean,value:true},LegendClickMode:{resolve:'_resolveFull',data:legendData,cast:pvc.parseLegendClickMode,value:'toggleVisible'},LegendDrawLine:{resolve:'_resolveFull',data:legendData,cast:Boolean,value:false},LegendDrawMarker:{resolve:'_resolveFull',data:legendData,cast:Boolean,value:true},LegendShape:{resolve:'_resolveFull',data:legendData,cast:pvc.parseShape}})});