def.type('pvc.data.RelationalTranslationOper',pvc.data.MatrixTranslationOper).add({M:0,C:0,S:0,_processMetadata:function(){this.base();var metadata=this.metadata;var J=this.J;var C=this.options.categoriesCount;if(C!=null&&(!isFinite(C)||C<0)){C=0}var S;var valuesColIndexes,M;if(this.options.isMultiValued){valuesColIndexes=pvc.parseDistinctIndexArray(this.options.measuresIndexes,J-1);M=valuesColIndexes?valuesColIndexes.length:0}var D;if(M==null){if(J>0&&J<=3&&(C==null||C===1)&&S==null){M=1;valuesColIndexes=[J-1];C=J>=2?1:0;S=J>=3?1:0;D=C+S}else if(C!=null&&C>=J){D=J;C=J;S=0;M=0}else{var Mmax=C!=null?(J-C):Infinity;valuesColIndexes=def.query(metadata).where(function(colDef,index){return this._columnTypes[index]!==0},this).select(function(colDef){return colDef.colIndex}).take(Mmax).array();M=valuesColIndexes.length}}if(D==null){D=J-M;if(D===0){S=C=0}else if(C!=null){if(C>D){C=D;S=0}else{S=D-C}}else{S=D>1?1:0;C=D-S}}var seriesInRows=this.options.seriesInRows;var colGroupSpecs=[];if(D){if(S&&!seriesInRows){colGroupSpecs.push({name:'S',count:S})}if(C){colGroupSpecs.push({name:'C',count:C})}if(S&&seriesInRows){colGroupSpecs.push({name:'S',count:S})}}if(M){colGroupSpecs.push({name:'M',count:M})}var availableInputIndexes=def.range(0,J).array();if(valuesColIndexes){valuesColIndexes.forEach(function(inputIndex){availableInputIndexes.splice(inputIndex,1)})}var specsByName={};colGroupSpecs.forEach(function(groupSpec){var count=groupSpec.count;var name=groupSpec.name;specsByName[name]=groupSpec;if(valuesColIndexes&&name==='M'){groupSpec.indexes=valuesColIndexes}else{groupSpec.indexes=availableInputIndexes.splice(0,count)}},this);this.M=M;this.S=S;this.C=C;var itemPerm=[];['S','C','M'].forEach(function(name){var groupSpec=specsByName[name];if(groupSpec){def.array.append(itemPerm,groupSpec.indexes)}});var colTypes=this._columnTypes;this._itemTypes=itemPerm.map(function(index){return colTypes[index]});this._itemCrossGroupIndex={S:0,C:this.S,M:this.S+this.C};this._itemPerm=itemPerm;if(pvc.debug>=3){var out=["RELATIONAL TRANSLATOR MAPPING",pvc.logSeparator,"["+colGroupSpecs.map(function(groupSpec){return def.array.create(groupSpec.count,groupSpec.name).join('')}).join(' ')+"]"];pvc.log(out.join("\n"))}},_configureTypeCore:function(){var me=this;var index=0;var dimsReaders=[];function add(dimGroupName,colGroupName,level,count){var groupEndIndex=me._itemCrossGroupIndex[colGroupName]+count;while(count>0){var dimName=pvc.buildIndexedId(dimGroupName,level);if(!me.complexTypeProj.isReadOrCalc(dimName)){index=me._nextAvailableItemIndex(index);if(index>=groupEndIndex){return}dimsReaders.push({names:dimName,indexes:index});index++;count--}level++}}if(this.S>0){add('series','S',0,this.S)}if(this.C>0){add('category','C',0,this.C)}if(this.M>0){add('value','M',0,this.M)}if(dimsReaders){dimsReaders.forEach(this.defReader,this)}var plot2SeriesIndexes=this.options.plot2SeriesIndexes;if(plot2SeriesIndexes!=null){var seriesReader=this._userDimsReadersByDim.series;if(seriesReader){var dataPartDimName=this.options.dataPartDimName;this._userRead(relTransl_dataPartGet.call(this,plot2SeriesIndexes,seriesReader),dataPartDimName)}}},_executeCore:function(){var dimsReaders=this._getDimensionsReaders();var permIndexes=this._itemPerm;return def.query(this._getItems()).select(function(item){item=pv.permute(item,permIndexes);return this._readItem(item,dimsReaders)},this)}});function relTransl_dataPartGet(plot2SeriesIndexes,seriesReader){var me=this;function calcAxis2SeriesKeySet(){var atoms={};var seriesKeys=def.query(me.source).select(function(item){seriesReader(item,atoms);var value=atoms.series;if(value!=null&&value.v!=null){value=value.v}return value||null}).distinct().array();return me._createPlot2SeriesKeySet(plot2SeriesIndexes,seriesKeys)}return this._dataPartGet(calcAxis2SeriesKeySet,seriesReader)}