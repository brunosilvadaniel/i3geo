pvc.BaseChart.add({_updateSelectionSuspendCount:0,_lastSelectedDatums:null,clearSelections:function(){if(this.data.owner.clearSelected()){this.updateSelections()}return this},_updatingSelections:function(method,context){this._suspendSelectionUpdate();try{method.call(context||this)}finally{this._resumeSelectionUpdate()}},_suspendSelectionUpdate:function(){if(this===this.root){this._updateSelectionSuspendCount++}else{this.root._suspendSelectionUpdate()}},_resumeSelectionUpdate:function(){if(this===this.root){if(this._updateSelectionSuspendCount>0){if(!(--this._updateSelectionSuspendCount)){this.updateSelections()}}}else{this.root._resumeSelectionUpdate()}},updateSelections:function(keyArgs){if(this===this.root){if(this._inUpdateSelections){return this}if(this._updateSelectionSuspendCount){return this}var selectedChangedDatumMap=this._calcSelectedChangedDatums();if(!selectedChangedDatumMap){return}pvc.removeTipsyLegends();this._inUpdateSelections=true;try{var action=this.options.selectionChangedAction;if(action){var selectedDatums=this.data.selectedDatums();var selectedChangedDatums=selectedChangedDatumMap.values();action.call(this.basePanel._getContext(),selectedDatums,selectedChangedDatums)}if(def.get(keyArgs,'render',true)){this.useTextMeasureCache(function(){this.basePanel.renderInteractive()},this)}}finally{this._inUpdateSelections=false}}else{this.root.updateSelections()}return this},_calcSelectedChangedDatums:function(){var selectedChangedDatums;var nowSelectedDatums=this.data.selectedDatumMap();var lastSelectedDatums=this._lastSelectedDatums;if(!lastSelectedDatums){if(!nowSelectedDatums.count){return}selectedChangedDatums=nowSelectedDatums.clone()}else{selectedChangedDatums=lastSelectedDatums.symmetricDifference(nowSelectedDatums);if(!selectedChangedDatums.count){return}}this._lastSelectedDatums=nowSelectedDatums;var datums=this._lastSelectedDatums?this._lastSelectedDatums.values():[];return selectedChangedDatums},_onUserSelection:function(datums){if(!datums||!datums.length){return datums}if(this===this.root){var action=this.options.userSelectionAction;if(action){return action.call(null,datums)||datums}return datums}return this.root._onUserSelection(datums)},_isSelectable:function(){return this.options.selectable},_canSelectWithRubberband:function(){var options=this.options;return options.selectable&&options.selectionMode==='rubberband'},_canSelectWithClick:function(){return this._canSelectWithRubberband()},_canSelectWithFocusWindow:function(){var options=this.options;return options.selectable&&options.selectionMode==='focuswindow'}});