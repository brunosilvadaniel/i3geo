pvc.data.Data.add({selectedCount:function(){if(!this.isOwner()){return this.datums(null,{selected:true}).count()}return this._selectedDatums.count},selectedDatums:function(){if(!this.isOwner()){return this.datums(null,{selected:true}).array()}return this._selectedDatums.values()},selectedDatumMap:function(){if(!this.isOwner()){var datums=this.datums(null,{selected:true}).object({name:function(datum){return datum.id}});return new def.Set(datums)}return this._selectedDatums.clone()},visibleCount:function(){return this._visibleDatums.count},replaceSelected:function(datums){if(!def.array.is(datums)){datums=datums.array()}var alreadySelectedById=def.query(datums).where(function(datum){return datum.isSelected}).object({name:function(datum){return datum.id}});var changed=this.owner.clearSelected(function(datum){return!def.hasOwn(alreadySelectedById,datum.id)});changed|=pvc.data.Data.setSelected(datums,true);return changed},clearSelected:function(funFilter){if(this.owner!==this){return this.owner.clearSelected(funFilter)}if(!this._selectedDatums.count){return false}var changed;if(funFilter){changed=false;this._selectedDatums.values().filter(funFilter).forEach(function(datum){changed=true;datum_deselect.call(datum);this._selectedDatums.rem(datum.id)},this)}else{changed=true;this._selectedDatums.values().forEach(function(datum){datum_deselect.call(datum)});this._selectedDatums.clear()}return changed}});function data_onDatumSelectedChanged(datum,selected){!datum.isNull||def.assert("Null datums do not notify selected changes");if(selected){this._selectedDatums.set(datum.id,datum)}else{this._selectedDatums.rem(datum.id)}this._sumAbsCache=null}function data_onDatumVisibleChanged(datum,visible){if(def.hasOwn(this._datumsById,datum.id)){!datum.isNull||def.assert("Null datums do not notify visible changes");if(visible){this._visibleDatums.set(datum.id,datum)}else{this._visibleDatums.rem(datum.id)}this._sumAbsCache=null;def.eachOwn(this._dimensions,function(dimension){dim_onDatumVisibleChanged.call(dimension,datum,visible)});this._children.forEach(function(data){data_onDatumVisibleChanged.call(data,datum,visible)});if(this._linkChildren){this._linkChildren.forEach(function(data){data_onDatumVisibleChanged.call(data,datum,visible)})}}}pvc.data.Data.setSelected=function(datums,selected){var anyChanged=false;if(datums){def.query(datums).each(function(datum){if(datum.setSelected(selected)){anyChanged=true}})}return anyChanged};pvc.data.Data.toggleSelected=function(datums){if(!def.array.isLike(datums)){datums=def.query(datums).array()}var allSelected=def.query(datums).all(function(datum){return datum.isNull||datum.isSelected});return this.setSelected(datums,!allSelected)};pvc.data.Data.setVisible=function(datums,visible){var anyChanged=false;if(datums){def.query(datums).each(function(datum){if(datum.setVisible(visible)){anyChanged=true}})}return anyChanged};pvc.data.Data.toggleVisible=function(datums){if(!def.array.isLike(datums)){datums=def.query(datums).array()}var allVisible=def.query(datums).all(function(datum){return datum.isVisible});return pvc.data.Data.setVisible(datums,!allVisible)};