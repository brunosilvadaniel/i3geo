var currentBalloonClass;var balloonIsVisible;var balloonIsSticky;var balloonInvisibleSelects;var balloonIsSuppressed;var tooltipIsSuppressed;var Balloon=function(){BalloonConfig(this);document.onmousemove=this.setActiveCoordinates;document.onscroll=Balloon.prototype.hideTooltip;window.onbeforeunload=function(){Balloon.prototype.hideTooltip(1);balloonIsSuppressed=true};if(this.isIE()){this.suppress=true}return this};Balloon.prototype.showTooltip=function(evt,caption,sticky,width){if(this.isIE()&&document.readyState.match(/complete/i)){this.suppress=false}if(this.suppress||balloonIsSuppressed){return false}if(tooltipIsSuppressed&&!sticky){return false}if(this.isKonqueror())this.allowFade=false;var mouseOver=true;try{var mouseOver=evt.type.match('mouseover','i')}catch(e){}if(!mouseOver){sticky=true;this.fadeOK=false}else{this.fadeOK=this.allowFade}if(balloonIsVisible&&!balloonIsSticky&&mouseOver)return false;if(balloonIsVisible&&balloonIsSticky&&!sticky)return false;try{var el=this.getEventTarget(evt)}catch(e){var el=evt}if(sticky&&mouseOver&&this.isSameElement(el,this.currentElement))return false;this.firingElement=el;if(sticky)this.hideTooltip(1);var closeBalloon=function(){var override=balloonIsSticky&&!balloonIsVisible;Balloon.prototype.hideTooltip(override);i3GEO.janela.excluiTips()};if(!mouseOver)el.onmouseup=function(){return false};el.onmouseout=closeBalloon;balloonIsSticky=sticky;this.width=width;this.hideTooltip();this.currentHelpText=this.getAndCheckContents(caption);if(!this.currentHelpText){return false}if(!this.container){this.container=document.createElement('div');document.body.appendChild(this.container);this.setStyle(this.container,'position','absolute');this.setStyle(this.container,'top',-8888);this.setStyle(this.container,'display','inline');this.setStyle(this.container,'z-index',2);this.setStyle(this.container,'color',this.fontColor);this.setStyle(this.container,'font-family',this.fontFamily);this.setStyle(this.container,'font-size',this.fontSize)}else{this.setStyle(this.container,'display','inline')}this.container.innerHTML=unescape(this.currentHelpText);if(this.images){this.balloonImage=this.balloonImage?this.images+'/'+this.balloonImage:false;this.ieImage=this.ieImage?this.images+'/'+this.ieImage:false;this.upLeftStem=this.upLeftStem?this.images+'/'+this.upLeftStem:false;this.upRightStem=this.upRightStem?this.images+'/'+this.upRightStem:false;this.downLeftStem=this.downLeftStem?this.images+'/'+this.downLeftStem:false;this.downRightStem=this.downRightStem?this.images+'/'+this.downRightStem:false;this.closeButton=this.closeButton?this.images+'/'+this.closeButton:false;this.images=false}if(this.isOldIE()&&this.ieImage){this.balloonImage=this.ieImage}if(!this.preloadedImages){var images=new Array(this.balloonImage,this.closeButton);if(this.ieImage){images.push(this.ieImage)}if(this.stem){images.push(this.upLeftStem,this.upRightStem,this.downLeftStem,this.downRightStem)}var len=images.length;for(var i=0;i<len;i++){if(images[i]){this.preload(images[i])}}this.preloadedImages=true}currentBalloonClass=this;if(!mouseOver)this.setActiveCoordinates(evt);this.setActiveCoordinates(evt);this.currentEvent=evt;this.doShowTooltip()};Balloon.prototype.preload=function(src){var i=new Image;i.src=src;this.setStyle(i,'position','absolute');this.setStyle(i,'top',-8000);document.body.appendChild(i);document.body.removeChild(i)};Balloon.prototype.doShowTooltip=function(){var self=currentBalloonClass;if(balloonIsVisible)return false;if(!self.parent){if(self.parentID){self.parent=document.getElementById(self.parentID)}else{self.parent=document.body}self.xOffset=self.getLoc(self.parent,'x1');self.yOffset=self.getLoc(self.parent,'y1')}window.clearTimeout(self.timeoutFade);self.setStyle('balloon','display','none');self.parseIntAll();var balloon=self.makeBalloon();var pageWidth=YAHOO.util.Dom.getViewportWidth();var pageCen=Math.round(pageWidth/2);var pageHeight=YAHOO.util.Dom.getViewportHeight();var pageLeft=YAHOO.util.Dom.getDocumentScrollLeft();var pageTop=YAHOO.util.Dom.getDocumentScrollTop();var pageMid=pageTop+Math.round(pageHeight/2);self.pageBottom=pageTop+pageHeight;self.pageTop=pageTop;if(!(self.activeTop&&self.activeRight)){self.setActiveCoordinates()}var vOrient=self.activeTop>pageMid?'up':'down';var hOrient=self.activeRight>pageCen?'left':'right';var helpText=self.container.innerHTML;self.contents.innerHTML=helpText;self.setBalloonStyle(vOrient,hOrient,pageWidth,pageLeft);if(balloonIsSticky){self.addCloseButton()}balloonIsVisible=true;self.showHide();self.fade(0,95,self.fadeIn)};Balloon.prototype.addCloseButton=function(){var self=currentBalloonClass;var margin=Math.round(self.padding/2);var closeWidth=self.closeButtonWidth||16;var balloonTop=self.getLoc('balloon','y1')+margin+self.shadow;var BalloonLeft=self.getLoc('topRight','x2')-self.closeButtonWidth-self.shadow-margin;var closeButton=document.getElementById('closeButton');if(!closeButton){closeButton=new Image;closeButton.setAttribute('id','closeButton');closeButton.setAttribute('src',self.closeButton);closeButton.onclick=function(){Balloon.prototype.hideTooltip(1);if($i("marcaIdentifica")){document.body.removeChild($i("marcaIdentifica"))}};self.setStyle(closeButton,'position','absolute');document.body.appendChild(closeButton)}self.setStyle(closeButton,'top',balloonTop);self.setStyle(closeButton,'left',BalloonLeft);self.setStyle(closeButton,'display','inline');self.setStyle(closeButton,'cursor','pointer');self.setStyle(closeButton,'z-index',999999999)};Balloon.prototype.makeBalloon=function(){var self=currentBalloonClass;var balloon=document.getElementById('balloon');if(balloon)self.parent.removeChild(balloon);balloon=document.createElement('div');balloon.setAttribute('id','balloon');self.parent.appendChild(balloon);self.activeBalloon=balloon;self.parts=new Array(balloon);var parts=new Array('contents','topRight','bottomRight','bottomLeft');for(var i=0;i<parts.length;i++){var child=document.createElement('div');child.setAttribute('id',parts[i]);balloon.appendChild(child);if(parts[i]=='contents')self.contents=child;self.parts.push(child)}self.setStyle('contents','z-index',2);self.setStyle('contents','color',self.fontColor);self.setStyle('contents','font-family',self.fontFamily);self.setStyle('contents','font-size',self.fontSize);if(balloonIsSticky){self.setStyle('contents','margin-right',10)}else if(self.displayTime){self.timeoutAutoClose=window.setTimeout(this.hideTooltip,self.displayTime)}return balloon};Balloon.prototype.setBalloonStyle=function(vOrient,hOrient,pageWidth,pageLeft){var self=currentBalloonClass;var balloon=self.activeBalloon;if(typeof(self.shadow)!='number')self.shadow=0;if(!self.stem)self.stemHeight=0;var fullPadding=self.padding+self.shadow;var insidePadding=self.padding;self.setStyle(balloon,'background','url('+self.balloonImage+') top left no-repeat');self.setStyle(balloon,'position','absolute');self.setStyle(balloon,'padding-top',fullPadding);self.setStyle(balloon,'padding-left',fullPadding);self.setStyle(balloon,'top',-9999);self.setStyle(balloon,'z-index',1000000);self.setStyle('bottomRight','background','url('+self.balloonImage+') bottom right no-repeat');self.setStyle('bottomRight','position','absolute');self.setStyle('bottomRight','right',0-fullPadding);self.setStyle('bottomRight','bottom',0-fullPadding);self.setStyle('bottomRight','height',fullPadding);self.setStyle('bottomRight','width',fullPadding);self.setStyle('bottomRight','z-index',-1);self.setStyle('topRight','background','url('+self.balloonImage+') top right no-repeat');self.setStyle('topRight','position','absolute');self.setStyle('topRight','right',0-fullPadding);self.setStyle('topRight','top',0);self.setStyle('topRight','width',fullPadding);self.setStyle('bottomLeft','background','url('+self.balloonImage+') bottom left no-repeat');self.setStyle('bottomLeft','position','absolute');self.setStyle('bottomLeft','left',0);self.setStyle('bottomLeft','bottom',0-fullPadding);self.setStyle('bottomLeft','height',fullPadding);self.setStyle('bottomLeft','z-index',-1);if(this.stem){var stem=document.createElement('img');self.setStyle(stem,'position','absolute');balloon.appendChild(stem);if(vOrient=='up'&&hOrient=='left'){stem.src=self.upLeftStem;var height=self.stemHeight+insidePadding-self.stemOverlap;self.setStyle(stem,'bottom',0-height);self.setStyle(stem,'right',0)}else if(vOrient=='down'&&hOrient=='left'){stem.src=self.downLeftStem;var height=self.stemHeight-(self.shadow+self.stemOverlap);self.setStyle(stem,'top',0-height);self.setStyle(stem,'right',0)}else if(vOrient=='up'&&hOrient=='right'){stem.src=self.upRightStem;var height=self.stemHeight+insidePadding-self.stemOverlap;self.setStyle(stem,'bottom',0-height);self.setStyle(stem,'left',self.shadow)}else if(vOrient=='down'&&hOrient=='right'){stem.src=self.downRightStem;var height=self.stemHeight-(self.shadow+self.stemOverlap);self.setStyle(stem,'top',0-height);self.setStyle(stem,'left',self.shadow)}}if(hOrient=='left'){var activeRight=pageWidth-self.activeLeft;self.setStyle(balloon,'right',activeRight)}else{self.setStyle(balloon,'left',self.activeRight-self.xOffset)}if(!self.width){var width=self.getLoc('contents','width');if(self.isIE())width+=50;if(width>self.maxWidth)width=self.maxWidth+50;if(width<self.minWidth)width=self.minWidth;self.setStyle(balloon,'width',width)}else{self.setStyle(balloon,'width',self.width)}var balloonPad=self.padding+self.shadow;var balloonLeft=self.getLoc(balloon,'x1');var balloonRight=self.getLoc(balloon,'x2');if(hOrient=='left')balloonLeft+=balloonPad;if(hOrient=='right')balloonRight+=balloonPad;var pageRight=pageLeft+pageWidth;if(hOrient=='right'&&balloonRight>(pageRight-30)){self.setStyle(balloon,'width',(pageRight-balloonLeft)-50)}else if(hOrient=='left'&&balloonLeft<(pageLeft+30)){self.setStyle(balloon,'width',(balloonRight-pageLeft)-50)}var lineWidth=self.getLoc(balloon,'width');var lineHeight=self.getLoc(balloon,'height');self.setStyle('topRight','height',lineHeight);self.setStyle('bottomLeft','width',lineWidth);var vOverlap=self.isOverlap('topRight','bottomRight');var hOverlap=self.isOverlap('bottomLeft','bottomRight');if(vOverlap)self.setStyle('topRight','height',lineHeight-vOverlap[1]);if(hOverlap)self.setStyle('bottomLeft','width',lineWidth-hOverlap[0]);if(vOrient=='up'){var activeTop=self.activeTop-self.vOffset-self.stemHeight-lineHeight;self.setStyle(balloon,'top',activeTop-self.yOffset);self.setStyle(balloon,'display','inline')}else{var activeTop=self.activeTop+self.vOffset+self.stemHeight;self.setStyle(balloon,'top',activeTop-self.yOffset)}self.setOpacity(1)};Balloon.prototype.fade=function(opacStart,opacEnd,millisec){var self=currentBalloonClass||new Balloon;var speed=Math.round(millisec/100);var timer=0;if(opacStart>opacEnd){if(self.fadeOK){for(o=opacStart;o>=opacEnd;o--){self.timeoutFade=setTimeout('Balloon.prototype.setOpacity('+o+')',(timer*speed));timer++}setTimeout("Balloon.prototype.setStyle('balloon','display','none')",millisec)}else{self.setStyle('balloon','display','none')}}else if(opacStart<opacEnd&&self.fadeOK){for(o=opacStart;o<=opacEnd;o++){self.timeoutFade=setTimeout('Balloon.prototype.setOpacity('+o+')',(timer*speed));timer++}}};Balloon.prototype.setOpacity=function(opc){var self=currentBalloonClass;if(!self||!self.fadeOK)return false;var o=parseFloat((opc||0)/100);var el=self.isIE()?'contents':'balloon';var b=document.getElementById(el);if(!b)return false;self.setStyle(b,'opacity',o);self.setStyle(b,'filter','alpha(opacity= '+opc+')');self.setStyle(b,'MozOpacity',o);self.setStyle(b,'KhtmlOpacity',o)};Balloon.prototype.hideTooltip=function(override){if(override&&typeof override=='object')override=false;if(balloonIsSticky&&!override)return false;var self=currentBalloonClass;if(self){window.clearTimeout(self.timeoutTooltip);window.clearTimeout(self.timeoutAutoClose)}if(balloonIsSticky&&self)self.currentElement=null;balloonIsVisible=false;balloonIsSticky=true;var closeButton=document.getElementById('closeButton');if(closeButton){YAHOO.util.Dom.setStyle(closeButton,'display','none')}if(!self){var hideBalloon=document.getElementById('balloon');if(hideBalloon)Balloon.prototype.setStyle(hideBalloon,'display','none')}else if(self.activeBalloon){if(!override&&self.fadeOK&&!self.isIE())self.fade(95,0,self.fadeOut);else self.setStyle(self.activeBalloon,'display','none')}Balloon.prototype.showHide(1)};hideAllTooltips=function(){var self=currentBalloonClass;if(!self)return;window.clearTimeout(self.timeoutTooltip);if(self.activeBalloon)self.setStyle(self.activeBalloon,'display','none');balloonIsVisible=false;balloonIsSticky=false;currentBalloonClass=null};Balloon.prototype.setActiveCoordinates=function(event){var self=currentBalloonClass;if(!self)return false;var b=self.activeBalloon;try{if(typeof(event.id)=="string"){var pos=i3GEO.util.pegaPosicaoObjeto(event);self.activeTop=pos[1]-10;self.activeLeft=pos[0]-10;self.activeRight=self.activeLeft+20;self.activeBottom=self.activeTop+20;return true}}catch(e){}var evt=event||window.event||self.currentEvent;if(!evt){return false}var XY=self.eventXY(evt);self.activeTop=XY[1]-10;self.activeLeft=XY[0]-10;self.activeRight=self.activeLeft+20;self.activeBottom=self.activeTop+20;return true};Balloon.prototype.eventXY=function(event){var XY=new Array(2);var e=event||window.event;if(e.pageX||e.pageY){XY[0]=e.pageX;XY[1]=e.pageY}else if(e.clientX||e.clientY){XY[0]=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;XY[1]=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}return XY};Balloon.prototype.getEventTarget=function(event){var targ;var e=event||window.event;if(e.target)targ=e.target;else if(e.srcElement)targ=e.srcElement;if(targ.nodeType==3)targ=targ.parentNode;return targ};Balloon.prototype.setStyle=function(el,att,val){if(!el)return false;if(val&&att.match(/left|top|bottom|right|width|height|padding|margin/))val+='px';if(typeof(el)!='object')el=document.getElementById(el);if(att=='z-index'){if(el.style){el.style.zIndex=parseInt(val)}}else{YAHOO.util.Dom.setStyle(el,att,val)}};Balloon.prototype.getLoc=function(el,request){var region=YAHOO.util.Dom.getRegion(el);switch(request){case('y1'):return parseInt(region.top);case('y2'):return parseInt(region.bottom);case('x1'):return parseInt(region.left);case('x2'):return parseInt(region.right);case('width'):return(parseInt(region.right)-parseInt(region.left));case('height'):return(parseInt(region.bottom)-parseInt(region.top));case('region'):return region}};Balloon.prototype.parseIntAll=function(){this.padding=parseInt(this.padding);this.shadow=parseInt(this.shadow);this.stemHeight=parseInt(this.stemHeight);this.stemOverlap=parseInt(this.stemOverlap);this.vOffset=parseInt(this.vOffset);this.delayTime=parseInt(this.delayTime);this.width=parseInt(this.width);this.maxWidth=parseInt(this.maxWidth);this.minWidth=parseInt(this.minWidth);this.fadeIn=parseInt(this.fadeIn);this.fadeOut=parseInt(this.fadeOut)};Balloon.prototype.showHide=function(visible){var self=currentBalloonClass||new Balloon;if(self.isOldIE()){if(!visible){var balloonSelects=document.getElementById('contents').getElementsByTagName('select');var myHash=new Object();for(var i=0;i<balloonSelects.length;i++){var id=balloonSelects[i].id||balloonSelects[i].name;myHash[id]=1}balloonInvisibleSelects=new Array();var allSelects=document.getElementsByTagName('select');for(var i=0;i<allSelects.length;i++){var id=allSelects[i].id||allSelects[i].name;if(self.isOverlap(allSelects[i],self.activeBalloon)&&!myHash[id]){balloonInvisibleSelects.push(allSelects[i]);self.setStyle(allSelects[i],'visibility','hidden')}}}else if(balloonInvisibleSelects){for(var i=0;i<balloonInvisibleSelects.length;i++){var id=balloonInvisibleSelects[i].id||balloonInvisibleSelects[i].name;self.setStyle(balloonInvisibleSelects[i],'visibility','visible')}balloonInvisibleSelects=null}}if(self.hide){var display=visible?'inline':'none';for(var n=0;n<self.hide.length;n++){if(self.isOverlap(self.activeBalloon,self.hide[n])){self.setStyle(self.hide[n],'display',display)}}}};Balloon.prototype.isOverlap=function(el1,el2){if(!el1||!el2)return false;var R1=this.getLoc(el1,'region');var R2=this.getLoc(el2,'region');if(!R1||!R2)return false;var intersect=R1.intersect(R2);if(intersect){intersect=new Array((intersect.right-intersect.left),(intersect.bottom-intersect.top))}return intersect};Balloon.prototype.isSameElement=function(el1,el2){if(!el1||!el2)return false;var R1=this.getLoc(el1,'region');var R2=this.getLoc(el2,'region');var same=R1.contains(R2)&&R2.contains(R1);return same?true:false};Balloon.prototype.getAndCheckContents=function(caption){var originalCaption=caption;var notAllowed='are not allowed in popup balloons in this web site.Please contact the site administrator for assistance.';var notSupported='AJAX is not supported for popup balloons in this web site. Please contact the site administrator for assistance.';if(this.helpUrl&&!this.allowAJAX){}if(caption.match(/^url:/)){this.activeUrl=caption.replace(/^url:/,'');caption=''}else if(caption.match(/^(https?:|\/|ftp:)\S+$/i)){this.activeUrl=caption;caption=''}if(this.activeUrl&&!this.allowAJAX){}if(caption.match(/^load:/)){var load=caption.split(':');if(!document.getElementById(load[1]))alert('problem locating element '+load[1]);caption=document.getElementById(load[1]).innerHTML;this.loadedFromElement=true}if(caption.match(/\<\s*iframe/i)&&!this.allowIframes){}if(caption.match(/\bon(load|mouse|click|unload|before)[^=]*=/i)&&!this.allowEventHandlers){}if(caption.match(/\<\s*script/i)&&!this.allowScripts){}this.currentHelpText=this.getContents(caption);this.loadedFromElement=false;return this.currentHelpText};Balloon.prototype.getContents=function(section){if(!this.helpUrl&&!this.activeUrl)return section;if(this.loadedFromElement)return section;var url=this.activeUrl||this.helpUrl;url+=this.activeUrl?'':'?section='+section;this.activeUrl=null;var ajax;if(window.XMLHttpRequest){ajax=new XMLHttpRequest()}else{ajax=new ActiveXObject("Microsoft.XMLHTTP")}if(ajax){ajax.open("GET",url,false);ajax.onreadystatechange=function(){};try{ajax.send(null)}catch(e){}var txt=this.escapeHTML?escape(ajax.responseText):ajax.responseText;return txt||section}else{return section}};Balloon.prototype.isIE=function(){return document.all&&!window.opera};Balloon.prototype.isOldIE=function(){if(navigator.appVersion.indexOf("MSIE")==-1)return false;var temp=navigator.appVersion.split("MSIE");return parseFloat(temp[1])<7};Balloon.prototype.isKonqueror=function(){return navigator.userAgent.indexOf('Konqueror')!=-1};